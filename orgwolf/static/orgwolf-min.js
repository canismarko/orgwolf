/*!
 * jQuery Cookie Plugin v1.3
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */
(function(f,b,g){var a=/\+/g;function e(h){return h}function c(h){return decodeURIComponent(h.replace(a," "))}var d=f.cookie=function(p,o,u){if(o!==g){u=f.extend({},d.defaults,u);if(o===null){u.expires=-1}if(typeof u.expires==="number"){var q=u.expires,s=u.expires=new Date();s.setDate(s.getDate()+q)}o=d.json?JSON.stringify(o):String(o);return(b.cookie=[encodeURIComponent(p),"=",d.raw?o:encodeURIComponent(o),u.expires?"; expires="+u.expires.toUTCString():"",u.path?"; path="+u.path:"",u.domain?"; domain="+u.domain:"",u.secure?"; secure":""].join(""))}var h=d.raw?e:c;var r=b.cookie.split("; ");for(var n=0,k=r.length;n<k;n++){var m=r[n].split("=");if(h(m.shift())===p){var j=h(m.join("="));return d.json?JSON.parse(j):j}}return null};d.defaults={};f.removeCookie=function(i,h){if(f.cookie(i)!==null){f.cookie(i,null,h);return true}return false}})(jQuery,document);(function(j,f){var c=j(window);function n(){return new Date(Date.UTC.apply(Date,arguments))}function g(){var q=new Date();return n(q.getFullYear(),q.getMonth(),q.getDate())}function l(q){return function(){return this[q].apply(this,arguments)}}var e=(function(){var q={get:function(r){return this.slice(r)[0]},contains:function(u){var t=u&&u.valueOf();for(var s=0,r=this.length;s<r;s++){if(this[s].valueOf()===t){return s}}return -1},remove:function(r){this.splice(r,1)},replace:function(r){if(!r){return}if(!j.isArray(r)){r=[r]}this.clear();this.push.apply(this,r)},clear:function(){this.splice(0)},copy:function(){var r=new e();r.replace(this);return r}};return function(){var r=[];r.push.apply(r,arguments);j.extend(r,q);return r}})();var k=function(r,q){this.dates=new e();this.viewDate=g();this.focusDate=null;this._process_options(q);this.element=j(r);this.isInline=false;this.isInput=this.element.is("input");this.component=this.element.is(".date")?this.element.find(".add-on, .input-group-addon, .btn"):false;this.hasInput=this.component&&this.element.find("input").length;if(this.component&&this.component.length===0){this.component=false}this.picker=j(m.template);this._buildEvents();this._attachEvents();if(this.isInline){this.picker.addClass("datepicker-inline").appendTo(this.element)}else{this.picker.addClass("datepicker-dropdown dropdown-menu")}if(this.o.rtl){this.picker.addClass("datepicker-rtl")}this.viewMode=this.o.startView;if(this.o.calendarWeeks){this.picker.find("tfoot th.today").attr("colspan",function(s,t){return parseInt(t)+1})}this._allow_update=false;this.setStartDate(this._o.startDate);this.setEndDate(this._o.endDate);this.setDaysOfWeekDisabled(this.o.daysOfWeekDisabled);this.fillDow();this.fillMonths();this._allow_update=true;this.update();this.showMode();if(this.isInline){this.show()}};k.prototype={constructor:k,_process_options:function(q){this._o=j.extend({},this._o,q);var u=this.o=j.extend({},this._o);var t=u.language;if(!b[t]){t=t.split("-")[0];if(!b[t]){t=h.language}}u.language=t;switch(u.startView){case 2:case"decade":u.startView=2;break;case 1:case"year":u.startView=1;break;default:u.startView=0}switch(u.minViewMode){case 1:case"months":u.minViewMode=1;break;case 2:case"years":u.minViewMode=2;break;default:u.minViewMode=0}u.startView=Math.max(u.startView,u.minViewMode);if(u.multidate!==true){u.multidate=Number(u.multidate)||false;if(u.multidate!==false){u.multidate=Math.max(0,u.multidate)}else{u.multidate=1}}u.multidateSeparator=String(u.multidateSeparator);u.weekStart%=7;u.weekEnd=((u.weekStart+6)%7);var r=m.parseFormat(u.format);if(u.startDate!==-Infinity){if(!!u.startDate){if(u.startDate instanceof Date){u.startDate=this._local_to_utc(this._zero_time(u.startDate))}else{u.startDate=m.parseDate(u.startDate,r,u.language)}}else{u.startDate=-Infinity}}if(u.endDate!==Infinity){if(!!u.endDate){if(u.endDate instanceof Date){u.endDate=this._local_to_utc(this._zero_time(u.endDate))}else{u.endDate=m.parseDate(u.endDate,r,u.language)}}else{u.endDate=Infinity}}u.daysOfWeekDisabled=u.daysOfWeekDisabled||[];if(!j.isArray(u.daysOfWeekDisabled)){u.daysOfWeekDisabled=u.daysOfWeekDisabled.split(/[,\s]*/)}u.daysOfWeekDisabled=j.map(u.daysOfWeekDisabled,function(w){return parseInt(w,10)});var s=String(u.orientation).toLowerCase().split(/\s+/g),v=u.orientation.toLowerCase();s=j.grep(s,function(w){return(/^auto|left|right|top|bottom$/).test(w)});u.orientation={x:"auto",y:"auto"};if(!v||v==="auto"){}else{if(s.length===1){switch(s[0]){case"top":case"bottom":u.orientation.y=s[0];break;case"left":case"right":u.orientation.x=s[0];break}}else{v=j.grep(s,function(w){return(/^left|right$/).test(w)});u.orientation.x=v[0]||"auto";v=j.grep(s,function(w){return(/^top|bottom$/).test(w)});u.orientation.y=v[0]||"auto"}}},_events:[],_secondaryEvents:[],_applyEvents:function(q){for(var r=0,t,s,u;r<q.length;r++){t=q[r][0];if(q[r].length===2){s=f;u=q[r][1]}else{if(q[r].length===3){s=q[r][1];u=q[r][2]}}t.on(u,s)}},_unapplyEvents:function(q){for(var r=0,t,u,s;r<q.length;r++){t=q[r][0];if(q[r].length===2){s=f;u=q[r][1]}else{if(q[r].length===3){s=q[r][1];u=q[r][2]}}t.off(u,s)}},_buildEvents:function(){if(this.isInput){this._events=[[this.element,{focus:j.proxy(this.show,this),keyup:j.proxy(function(q){if(j.inArray(q.keyCode,[27,37,39,38,40,32,13,9])===-1){this.update()}},this),keydown:j.proxy(this.keydown,this)}]]}else{if(this.component&&this.hasInput){this._events=[[this.element.find("input"),{focus:j.proxy(this.show,this),keyup:j.proxy(function(q){if(j.inArray(q.keyCode,[27,37,39,38,40,32,13,9])===-1){this.update()}},this),keydown:j.proxy(this.keydown,this)}],[this.component,{click:j.proxy(this.show,this)}]]}else{if(this.element.is("div")){this.isInline=true}else{this._events=[[this.element,{click:j.proxy(this.show,this)}]]}}}this._events.push([this.element,"*",{blur:j.proxy(function(q){this._focused_from=q.target},this)}],[this.element,{blur:j.proxy(function(q){this._focused_from=q.target},this)}]);this._secondaryEvents=[[this.picker,{click:j.proxy(this.click,this)}],[j(window),{resize:j.proxy(this.place,this)}],[j(document),{"mousedown touchstart":j.proxy(function(q){if(!(this.element.is(q.target)||this.element.find(q.target).length||this.picker.is(q.target)||this.picker.find(q.target).length)){this.hide()}},this)}]]},_attachEvents:function(){this._detachEvents();this._applyEvents(this._events)},_detachEvents:function(){this._unapplyEvents(this._events)},_attachSecondaryEvents:function(){this._detachSecondaryEvents();this._applyEvents(this._secondaryEvents)},_detachSecondaryEvents:function(){this._unapplyEvents(this._secondaryEvents)},_trigger:function(s,t){var r=t||this.dates.get(-1),q=this._utc_to_local(r);this.element.trigger({type:s,date:q,dates:j.map(this.dates,this._utc_to_local),format:j.proxy(function(u,w){if(arguments.length===0){u=this.dates.length-1;w=this.o.format}else{if(typeof u==="string"){w=u;u=this.dates.length-1}}w=w||this.o.format;var v=this.dates.get(u);return m.formatDate(v,w,this.o.language)},this)})},show:function(){if(!this.isInline){this.picker.appendTo("body")}this.picker.show();this.place();this._attachSecondaryEvents();this._trigger("show")},hide:function(){if(this.isInline){return}if(!this.picker.is(":visible")){return}this.focusDate=null;this.picker.hide().detach();this._detachSecondaryEvents();this.viewMode=this.o.startView;this.showMode();if(this.o.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())){this.setValue()}this._trigger("hide")},remove:function(){this.hide();this._detachEvents();this._detachSecondaryEvents();this.picker.remove();delete this.element.data().datepicker;if(!this.isInput){delete this.element.data().date}},_utc_to_local:function(q){return q&&new Date(q.getTime()+(q.getTimezoneOffset()*60000))},_local_to_utc:function(q){return q&&new Date(q.getTime()-(q.getTimezoneOffset()*60000))},_zero_time:function(q){return q&&new Date(q.getFullYear(),q.getMonth(),q.getDate())},_zero_utc_time:function(q){return q&&new Date(Date.UTC(q.getUTCFullYear(),q.getUTCMonth(),q.getUTCDate()))},getDates:function(){return j.map(this.dates,this._utc_to_local)},getUTCDates:function(){return j.map(this.dates,function(q){return new Date(q)})},getDate:function(){return this._utc_to_local(this.getUTCDate())},getUTCDate:function(){return new Date(this.dates.get(-1))},setDates:function(){this.update.apply(this,arguments);this._trigger("changeDate");this.setValue()},setUTCDates:function(){this.update.apply(this,j.map(arguments,this._utc_to_local));this._trigger("changeDate");this.setValue()},setDate:l("setDates"),setUTCDate:l("setUTCDates"),setValue:function(){var q=this.getFormattedDate();if(!this.isInput){if(this.component){this.element.find("input").val(q).change()}}else{this.element.val(q).change()}},getFormattedDate:function(q){if(q===f){q=this.o.format}var r=this.o.language;return j.map(this.dates,function(s){return m.formatDate(s,q,r)}).join(this.o.multidateSeparator)},setStartDate:function(q){this._process_options({startDate:q});this.update();this.updateNavArrows()},setEndDate:function(q){this._process_options({endDate:q});this.update();this.updateNavArrows()},setDaysOfWeekDisabled:function(q){this._process_options({daysOfWeekDisabled:q});this.update();this.updateNavArrows()},place:function(){if(this.isInline){return}var E=this.picker.outerWidth(),A=this.picker.outerHeight(),u=10,w=c.width(),r=c.height(),v=c.scrollTop();var C=parseInt(this.element.parents().filter(function(){var F=j(this).css("z-index");return F!="auto"&&F!="0"}).first().css("z-index"))+10;var z=this.component?this.component.parent().offset():this.element.offset();var D=this.component?this.component.outerHeight(true):this.element.outerHeight(false);var t=this.component?this.component.outerWidth(true):this.element.outerWidth(false);var y=z.left,B=z.top;this.picker.removeClass("datepicker-orient-top datepicker-orient-bottom datepicker-orient-right datepicker-orient-left");if(this.o.orientation.x!=="auto"){this.picker.addClass("datepicker-orient-"+this.o.orientation.x);if(this.o.orientation.x==="right"){y-=E-t}}else{this.picker.addClass("datepicker-orient-left");if(z.left<0){y-=z.left-u}else{if(z.left+E>w){y=w-E-u}}}var q=this.o.orientation.y,s,x;if(q==="auto"){s=-v+z.top-A;x=v+r-(z.top+D+A);if(Math.max(s,x)===x){q="top"}else{q="bottom"}}this.picker.addClass("datepicker-orient-"+q);if(q==="top"){B+=D}else{B-=A+parseInt(this.picker.css("padding-top"))}this.picker.css({top:B,left:y,zIndex:C})},_allow_update:true,update:function(){if(!this._allow_update){return}var r=this.dates.copy(),s=[],q=false;if(arguments.length){j.each(arguments,j.proxy(function(u,t){if(t instanceof Date){t=this._local_to_utc(t)}s.push(t)},this));q=true}else{s=this.isInput?this.element.val():this.element.data("date")||this.element.find("input").val();if(s&&this.o.multidate){s=s.split(this.o.multidateSeparator)}else{s=[s]}delete this.element.data().date}s=j.map(s,j.proxy(function(t){return m.parseDate(t,this.o.format,this.o.language)},this));s=j.grep(s,j.proxy(function(t){return(t<this.o.startDate||t>this.o.endDate||!t)},this),true);this.dates.replace(s);if(this.dates.length){this.viewDate=new Date(this.dates.get(-1))}else{if(this.viewDate<this.o.startDate){this.viewDate=new Date(this.o.startDate)}else{if(this.viewDate>this.o.endDate){this.viewDate=new Date(this.o.endDate)}}}if(q){this.setValue()}else{if(s.length){if(String(r)!==String(this.dates)){this._trigger("changeDate")}}}if(!this.dates.length&&r.length){this._trigger("clearDate")}this.fill()},fillDow:function(){var r=this.o.weekStart,s="<tr>";if(this.o.calendarWeeks){var q='<th class="cw">&nbsp;</th>';s+=q;this.picker.find(".datepicker-days thead tr:first-child").prepend(q)}while(r<this.o.weekStart+7){s+='<th class="dow">'+b[this.o.language].daysMin[(r++)%7]+"</th>"}s+="</tr>";this.picker.find(".datepicker-days thead").append(s)},fillMonths:function(){var r="",q=0;while(q<12){r+='<span class="month">'+b[this.o.language].monthsShort[q++]+"</span>"}this.picker.find(".datepicker-months td").html(r)},setRange:function(q){if(!q||!q.length){delete this.range}else{this.range=j.map(q,function(r){return r.valueOf()})}this.fill()},getClassNames:function(s){var q=[],t=this.viewDate.getUTCFullYear(),u=this.viewDate.getUTCMonth(),r=new Date();if(s.getUTCFullYear()<t||(s.getUTCFullYear()===t&&s.getUTCMonth()<u)){q.push("old")}else{if(s.getUTCFullYear()>t||(s.getUTCFullYear()===t&&s.getUTCMonth()>u)){q.push("new")}}if(this.focusDate&&s.valueOf()===this.focusDate.valueOf()){q.push("focused")}if(this.o.todayHighlight&&s.getUTCFullYear()===r.getFullYear()&&s.getUTCMonth()===r.getMonth()&&s.getUTCDate()===r.getDate()){q.push("today")}if(this.dates.contains(s)!==-1){q.push("active")}if(s.valueOf()<this.o.startDate||s.valueOf()>this.o.endDate||j.inArray(s.getUTCDay(),this.o.daysOfWeekDisabled)!==-1){q.push("disabled")}if(this.range){if(s>this.range[0]&&s<this.range[this.range.length-1]){q.push("range")}if(j.inArray(s.valueOf(),this.range)!==-1){q.push("selected")}}return q},fill:function(){var J=new Date(this.viewDate),y=J.getUTCFullYear(),K=J.getUTCMonth(),D=this.o.startDate!==-Infinity?this.o.startDate.getUTCFullYear():-Infinity,H=this.o.startDate!==-Infinity?this.o.startDate.getUTCMonth():-Infinity,w=this.o.endDate!==Infinity?this.o.endDate.getUTCFullYear():Infinity,E=this.o.endDate!==Infinity?this.o.endDate.getUTCMonth():Infinity,t;this.picker.find(".datepicker-days thead th.datepicker-switch").text(b[this.o.language].months[K]+" "+y);this.picker.find("tfoot th.today").text(b[this.o.language].today).toggle(this.o.todayBtn!==false);this.picker.find("tfoot th.clear").text(b[this.o.language].clear).toggle(this.o.clearBtn!==false);this.updateNavArrows();this.fillMonths();var M=n(y,K-1,28),G=m.getDaysInMonth(M.getUTCFullYear(),M.getUTCMonth());M.setUTCDate(G);M.setUTCDate(G-(M.getUTCDay()-this.o.weekStart+7)%7);var q=new Date(M);q.setUTCDate(q.getUTCDate()+42);q=q.valueOf();var x=[];var B;while(M.valueOf()<q){if(M.getUTCDay()===this.o.weekStart){x.push("<tr>");if(this.o.calendarWeeks){var r=new Date(+M+(this.o.weekStart-M.getUTCDay()-7)%7*86400000),u=new Date(+r+(7+4-r.getUTCDay())%7*86400000),s=new Date(+(s=n(u.getUTCFullYear(),0,1))+(7+4-s.getUTCDay())%7*86400000),z=(u-s)/86400000/7+1;x.push('<td class="cw">'+z+"</td>")}}B=this.getClassNames(M);B.push("day");if(this.o.beforeShowDay!==j.noop){var A=this.o.beforeShowDay(this._utc_to_local(M));if(A===f){A={}}else{if(typeof(A)==="boolean"){A={enabled:A}}else{if(typeof(A)==="string"){A={classes:A}}}}if(A.enabled===false){B.push("disabled")}if(A.classes){B=B.concat(A.classes.split(/\s+/))}if(A.tooltip){t=A.tooltip}}B=j.unique(B);x.push('<td class="'+B.join(" ")+'"'+(t?' title="'+t+'"':"")+">"+M.getUTCDate()+"</td>");if(M.getUTCDay()===this.o.weekEnd){x.push("</tr>")}M.setUTCDate(M.getUTCDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(x.join(""));var v=this.picker.find(".datepicker-months").find("th:eq(1)").text(y).end().find("span").removeClass("active");j.each(this.dates,function(N,O){if(O.getUTCFullYear()===y){v.eq(O.getUTCMonth()).addClass("active")}});if(y<D||y>w){v.addClass("disabled")}if(y===D){v.slice(0,H).addClass("disabled")}if(y===w){v.slice(E+1).addClass("disabled")}x="";y=parseInt(y/10,10)*10;var L=this.picker.find(".datepicker-years").find("th:eq(1)").text(y+"-"+(y+9)).end().find("td");y-=1;var C=j.map(this.dates,function(N){return N.getUTCFullYear()}),I;for(var F=-1;F<11;F++){I=["year"];if(F===-1){I.push("old")}else{if(F===10){I.push("new")}}if(j.inArray(y,C)!==-1){I.push("active")}if(y<D||y>w){I.push("disabled")}x+='<span class="'+I.join(" ")+'">'+y+"</span>";y+=1}L.html(x)},updateNavArrows:function(){if(!this._allow_update){return}var s=new Date(this.viewDate),q=s.getUTCFullYear(),r=s.getUTCMonth();switch(this.viewMode){case 0:if(this.o.startDate!==-Infinity&&q<=this.o.startDate.getUTCFullYear()&&r<=this.o.startDate.getUTCMonth()){this.picker.find(".prev").css({visibility:"hidden"})}else{this.picker.find(".prev").css({visibility:"visible"})}if(this.o.endDate!==Infinity&&q>=this.o.endDate.getUTCFullYear()&&r>=this.o.endDate.getUTCMonth()){this.picker.find(".next").css({visibility:"hidden"})}else{this.picker.find(".next").css({visibility:"visible"})}break;case 1:case 2:if(this.o.startDate!==-Infinity&&q<=this.o.startDate.getUTCFullYear()){this.picker.find(".prev").css({visibility:"hidden"})}else{this.picker.find(".prev").css({visibility:"visible"})}if(this.o.endDate!==Infinity&&q>=this.o.endDate.getUTCFullYear()){this.picker.find(".next").css({visibility:"hidden"})}else{this.picker.find(".next").css({visibility:"visible"})}break}},click:function(u){u.preventDefault();var v=j(u.target).closest("span, td, th"),x,w,y;if(v.length===1){switch(v[0].nodeName.toLowerCase()){case"th":switch(v[0].className){case"datepicker-switch":this.showMode(1);break;case"prev":case"next":var q=m.modes[this.viewMode].navStep*(v[0].className==="prev"?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveMonth(this.viewDate,q);this._trigger("changeMonth",this.viewDate);break;case 1:case 2:this.viewDate=this.moveYear(this.viewDate,q);if(this.viewMode===1){this._trigger("changeYear",this.viewDate)}break}this.fill();break;case"today":var r=new Date();r=n(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0);this.showMode(-2);var s=this.o.todayBtn==="linked"?null:"view";this._setDate(r,s);break;case"clear":var t;if(this.isInput){t=this.element}else{if(this.component){t=this.element.find("input")}}if(t){t.val("").change()}this.update();this._trigger("changeDate");if(this.o.autoclose){this.hide()}break}break;case"span":if(!v.is(".disabled")){this.viewDate.setUTCDate(1);if(v.is(".month")){y=1;w=v.parent().find("span").index(v);x=this.viewDate.getUTCFullYear();this.viewDate.setUTCMonth(w);this._trigger("changeMonth",this.viewDate);if(this.o.minViewMode===1){this._setDate(n(x,w,y))}}else{y=1;w=0;x=parseInt(v.text(),10)||0;this.viewDate.setUTCFullYear(x);this._trigger("changeYear",this.viewDate);if(this.o.minViewMode===2){this._setDate(n(x,w,y))}}this.showMode(-1);this.fill()}break;case"td":if(v.is(".day")&&!v.is(".disabled")){y=parseInt(v.text(),10)||1;x=this.viewDate.getUTCFullYear();w=this.viewDate.getUTCMonth();if(v.is(".old")){if(w===0){w=11;x-=1}else{w-=1}}else{if(v.is(".new")){if(w===11){w=0;x+=1}else{w+=1}}}this._setDate(n(x,w,y))}break}}if(this.picker.is(":visible")&&this._focused_from){j(this._focused_from).focus()}delete this._focused_from},_toggle_multidate:function(r){var q=this.dates.contains(r);if(!r){this.dates.clear()}else{if(q!==-1){this.dates.remove(q)}else{this.dates.push(r)}}if(typeof this.o.multidate==="number"){while(this.dates.length>this.o.multidate){this.dates.remove(0)}}},_setDate:function(q,s){if(!s||s==="date"){this._toggle_multidate(q&&new Date(q))}if(!s||s==="view"){this.viewDate=q&&new Date(q)}this.fill();this.setValue();this._trigger("changeDate");var r;if(this.isInput){r=this.element}else{if(this.component){r=this.element.find("input")}}if(r){r.change()}if(this.o.autoclose&&(!s||s==="date")){this.hide()}},moveMonth:function(q,r){if(!q){return f}if(!r){return q}var u=new Date(q.valueOf()),y=u.getUTCDate(),v=u.getUTCMonth(),t=Math.abs(r),x,w;r=r>0?1:-1;if(t===1){w=r===-1?function(){return u.getUTCMonth()===v}:function(){return u.getUTCMonth()!==x};x=v+r;u.setUTCMonth(x);if(x<0||x>11){x=(x+12)%12}}else{for(var s=0;s<t;s++){u=this.moveMonth(u,r)}x=u.getUTCMonth();u.setUTCDate(y);w=function(){return x!==u.getUTCMonth()}}while(w()){u.setUTCDate(--y);u.setUTCMonth(x)}return u},moveYear:function(r,q){return this.moveMonth(r,q*12)},dateWithinRange:function(q){return q>=this.o.startDate&&q<=this.o.endDate},keydown:function(w){if(this.picker.is(":not(:visible)")){if(w.keyCode===27){this.show()}return}var s=false,r,q,u,v=this.focusDate||this.viewDate;switch(w.keyCode){case 27:if(this.focusDate){this.focusDate=null;this.viewDate=this.dates.get(-1)||this.viewDate;this.fill()}else{this.hide()}w.preventDefault();break;case 37:case 39:if(!this.o.keyboardNavigation){break}r=w.keyCode===37?-1:1;if(w.ctrlKey){q=this.moveYear(this.dates.get(-1)||g(),r);u=this.moveYear(v,r);this._trigger("changeYear",this.viewDate)}else{if(w.shiftKey){q=this.moveMonth(this.dates.get(-1)||g(),r);u=this.moveMonth(v,r);this._trigger("changeMonth",this.viewDate)}else{q=new Date(this.dates.get(-1)||g());q.setUTCDate(q.getUTCDate()+r);u=new Date(v);u.setUTCDate(v.getUTCDate()+r)}}if(this.dateWithinRange(q)){this.focusDate=this.viewDate=u;this.setValue();this.fill();w.preventDefault()}break;case 38:case 40:if(!this.o.keyboardNavigation){break}r=w.keyCode===38?-1:1;if(w.ctrlKey){q=this.moveYear(this.dates.get(-1)||g(),r);u=this.moveYear(v,r);this._trigger("changeYear",this.viewDate)}else{if(w.shiftKey){q=this.moveMonth(this.dates.get(-1)||g(),r);u=this.moveMonth(v,r);this._trigger("changeMonth",this.viewDate)}else{q=new Date(this.dates.get(-1)||g());q.setUTCDate(q.getUTCDate()+r*7);u=new Date(v);u.setUTCDate(v.getUTCDate()+r*7)}}if(this.dateWithinRange(q)){this.focusDate=this.viewDate=u;this.setValue();this.fill();w.preventDefault()}break;case 32:break;case 13:v=this.focusDate||this.dates.get(-1)||this.viewDate;this._toggle_multidate(v);s=true;this.focusDate=null;this.viewDate=this.dates.get(-1)||this.viewDate;this.setValue();this.fill();if(this.picker.is(":visible")){w.preventDefault();if(this.o.autoclose){this.hide()}}break;case 9:this.focusDate=null;this.viewDate=this.dates.get(-1)||this.viewDate;this.fill();this.hide();break}if(s){if(this.dates.length){this._trigger("changeDate")}else{this._trigger("clearDate")}var t;if(this.isInput){t=this.element}else{if(this.component){t=this.element.find("input")}}if(t){t.change()}}},showMode:function(q){if(q){this.viewMode=Math.max(this.o.minViewMode,Math.min(2,this.viewMode+q))}this.picker.find(">div").hide().filter(".datepicker-"+m.modes[this.viewMode].clsName).css("display","block");this.updateNavArrows()}};var p=function(r,q){this.element=j(r);this.inputs=j.map(q.inputs,function(s){return s.jquery?s[0]:s});delete q.inputs;j(this.inputs).datepicker(q).bind("changeDate",j.proxy(this.dateUpdated,this));this.pickers=j.map(this.inputs,function(s){return j(s).data("datepicker")});this.updateDates()};p.prototype={updateDates:function(){this.dates=j.map(this.pickers,function(q){return q.getUTCDate()});this.updateRanges()},updateRanges:function(){var q=j.map(this.dates,function(r){return r.valueOf()});j.each(this.pickers,function(r,s){s.setRange(q)})},dateUpdated:function(t){if(this.updating){return}this.updating=true;var u=j(t.target).data("datepicker"),s=u.getUTCDate(),r=j.inArray(t.target,this.inputs),q=this.inputs.length;if(r===-1){return}j.each(this.pickers,function(v,w){if(!w.getUTCDate()){w.setUTCDate(s)}});if(s<this.dates[r]){while(r>=0&&s<this.dates[r]){this.pickers[r--].setUTCDate(s)}}else{if(s>this.dates[r]){while(r<q&&s>this.dates[r]){this.pickers[r++].setUTCDate(s)}}}this.updateDates();delete this.updating},remove:function(){j.map(this.pickers,function(q){q.remove()});delete this.element.data().datepicker}};function i(t,w){var v=j(t).data(),q={},u,s=new RegExp("^"+w.toLowerCase()+"([A-Z])");w=new RegExp("^"+w.toLowerCase());function x(z,y){return y.toLowerCase()}for(var r in v){if(w.test(r)){u=r.replace(s,x);q[u]=v[r]}}return q}function a(s){var q={};if(!b[s]){s=s.split("-")[0];if(!b[s]){return}}var r=b[s];j.each(o,function(u,t){if(t in r){q[t]=r[t]}});return q}var d=j.fn.datepicker;j.fn.datepicker=function(s){var q=Array.apply(null,arguments);q.shift();var r;this.each(function(){var A=j(this),y=A.data("datepicker"),u=typeof s==="object"&&s;if(!y){var w=i(this,"date"),t=j.extend({},h,w,u),v=a(t.language),x=j.extend({},h,v,w,u);if(A.is(".input-daterange")||x.inputs){var z={inputs:x.inputs||A.find("input").toArray()};A.data("datepicker",(y=new p(this,j.extend(x,z))))}else{A.data("datepicker",(y=new k(this,x)))}}if(typeof s==="string"&&typeof y[s]==="function"){r=y[s].apply(y,q);if(r!==f){return false}}});if(r!==f){return r}else{return this}};var h=j.fn.datepicker.defaults={autoclose:false,beforeShowDay:j.noop,calendarWeeks:false,clearBtn:false,daysOfWeekDisabled:[],endDate:Infinity,forceParse:true,format:"mm/dd/yyyy",keyboardNavigation:true,language:"en",minViewMode:0,multidate:false,multidateSeparator:",",orientation:"auto",rtl:false,startDate:-Infinity,startView:0,todayBtn:false,todayHighlight:false,weekStart:0};var o=j.fn.datepicker.locale_opts=["format","rtl","weekStart"];j.fn.datepicker.Constructor=k;var b=j.fn.datepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear"}};var m={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(q){return(((q%4===0)&&(q%100!==0))||(q%400===0))},getDaysInMonth:function(q,r){return[31,(m.isLeapYear(q)?29:28),31,30,31,30,31,31,30,31,30,31][r]},validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,parseFormat:function(s){var q=s.replace(this.validParts,"\0").split("\0"),r=s.match(this.validParts);if(!q||!q.length||!r||r.length===0){throw new Error("Invalid date format.")}return{separators:q,parts:r}},parseDate:function(H,E,B){if(!H){return f}if(H instanceof Date){return H}if(typeof E==="string"){E=m.parseFormat(E)}var t=/([\-+]\d+)([dmwy])/,z=H.match(/([\-+]\d+)([dmwy])/g),A,y,D;if(/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(H)){H=new Date();for(D=0;D<z.length;D++){A=t.exec(z[D]);y=parseInt(A[1]);switch(A[2]){case"d":H.setUTCDate(H.getUTCDate()+y);break;case"m":H=k.prototype.moveMonth.call(k.prototype,H,y);break;case"w":H.setUTCDate(H.getUTCDate()+y*7);break;case"y":H=k.prototype.moveYear.call(k.prototype,H,y);break}}return n(H.getUTCFullYear(),H.getUTCMonth(),H.getUTCDate(),0,0,0)}z=H&&H.match(this.nonpunctuation)||[];H=new Date();var u={},F=["yyyy","yy","M","MM","m","mm","d","dd"],x={yyyy:function(J,s){return J.setUTCFullYear(s)},yy:function(J,s){return J.setUTCFullYear(2000+s)},m:function(J,s){if(isNaN(J)){return J}s-=1;while(s<0){s+=12}s%=12;J.setUTCMonth(s);while(J.getUTCMonth()!==s){J.setUTCDate(J.getUTCDate()-1)}return J},d:function(J,s){return J.setUTCDate(s)}},I,r;x.M=x.MM=x.mm=x.m;x.dd=x.d;H=n(H.getFullYear(),H.getMonth(),H.getDate(),0,0,0);var q=E.parts.slice();if(z.length!==q.length){q=j(q).filter(function(s,J){return j.inArray(J,F)!==-1}).toArray()}function G(){var s=this.slice(0,z[D].length),J=z[D].slice(0,s.length);return s===J}if(z.length===q.length){var C;for(D=0,C=q.length;D<C;D++){I=parseInt(z[D],10);A=q[D];if(isNaN(I)){switch(A){case"MM":r=j(b[B].months).filter(G);I=j.inArray(r[0],b[B].months)+1;break;case"M":r=j(b[B].monthsShort).filter(G);I=j.inArray(r[0],b[B].monthsShort)+1;break}}u[A]=I}var v,w;for(D=0;D<F.length;D++){w=F[D];if(w in u&&!isNaN(u[w])){v=new Date(H);x[w](v,u[w]);if(!isNaN(v)){H=v}}}}return H},formatDate:function(q,u,w){if(!q){return""}if(typeof u==="string"){u=m.parseFormat(u)}var v={d:q.getUTCDate(),D:b[w].daysShort[q.getUTCDay()],DD:b[w].days[q.getUTCDay()],m:q.getUTCMonth()+1,M:b[w].monthsShort[q.getUTCMonth()],MM:b[w].months[q.getUTCMonth()],yy:q.getUTCFullYear().toString().substring(2),yyyy:q.getUTCFullYear()};v.dd=(v.d<10?"0":"")+v.d;v.mm=(v.m<10?"0":"")+v.m;q=[];var t=j.extend([],u.separators);for(var s=0,r=u.parts.length;s<=r;s++){if(t.length){q.push(t.shift())}q.push(v[u.parts[s]])}return q.join("")},headTemplate:'<thead><tr><th class="prev">&laquo;</th><th colspan="5" class="datepicker-switch"></th><th class="next">&raquo;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr><tr><th colspan="7" class="clear"></th></tr></tfoot>'};m.template='<div class="datepicker"><div class="datepicker-days"><table class=" table-condensed">'+m.headTemplate+"<tbody></tbody>"+m.footTemplate+'</table></div><div class="datepicker-months"><table class="table-condensed">'+m.headTemplate+m.contTemplate+m.footTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+m.headTemplate+m.contTemplate+m.footTemplate+"</table></div></div>";j.fn.datepicker.DPGlobal=m;j.fn.datepicker.noConflict=function(){j.fn.datepicker=d;return this};j(document).on("focus.datepicker.data-api click.datepicker.data-api",'[data-provide="datepicker"]',function(r){var q=j(this);if(q.data("datepicker")){return}r.preventDefault();q.datepicker("show")});j(function(){j('[data-provide="datepicker-inline"]').datepicker()})}(window.jQuery));/*!
 * Timepicker Component for Twitter Bootstrap
 *
 * Copyright 2013 Joris de Wit
 *
 * Contributors https://github.com/jdewit/bootstrap-timepicker/graphs/contributors
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */
(function(d,c,a,e){var b=function(g,f){this.widget="";this.$element=d(g);this.defaultTime=f.defaultTime;this.disableFocus=f.disableFocus;this.disableMousewheel=f.disableMousewheel;this.isOpen=f.isOpen;this.minuteStep=f.minuteStep;this.modalBackdrop=f.modalBackdrop;this.orientation=f.orientation;this.secondStep=f.secondStep;this.showInputs=f.showInputs;this.showMeridian=f.showMeridian;this.showSeconds=f.showSeconds;this.template=f.template;this.appendWidgetTo=f.appendWidgetTo;this.showWidgetOnAddonClick=f.showWidgetOnAddonClick;this._init()};b.prototype={constructor:b,_init:function(){var f=this;if(this.showWidgetOnAddonClick&&(this.$element.parent().hasClass("input-append")||this.$element.parent().hasClass("input-prepend"))){this.$element.parent(".input-append, .input-prepend").find(".add-on").on({"click.timepicker":d.proxy(this.showWidget,this)});this.$element.on({"focus.timepicker":d.proxy(this.highlightUnit,this),"click.timepicker":d.proxy(this.highlightUnit,this),"keydown.timepicker":d.proxy(this.elementKeydown,this),"blur.timepicker":d.proxy(this.blurElement,this),"mousewheel.timepicker DOMMouseScroll.timepicker":d.proxy(this.mousewheel,this)})}else{if(this.template){this.$element.on({"focus.timepicker":d.proxy(this.showWidget,this),"click.timepicker":d.proxy(this.showWidget,this),"blur.timepicker":d.proxy(this.blurElement,this),"mousewheel.timepicker DOMMouseScroll.timepicker":d.proxy(this.mousewheel,this)})}else{this.$element.on({"focus.timepicker":d.proxy(this.highlightUnit,this),"click.timepicker":d.proxy(this.highlightUnit,this),"keydown.timepicker":d.proxy(this.elementKeydown,this),"blur.timepicker":d.proxy(this.blurElement,this),"mousewheel.timepicker DOMMouseScroll.timepicker":d.proxy(this.mousewheel,this)})}}if(this.template!==false){this.$widget=d(this.getTemplate()).on("click",d.proxy(this.widgetClick,this))}else{this.$widget=false}if(this.showInputs&&this.$widget!==false){this.$widget.find("input").each(function(){d(this).on({"click.timepicker":function(){d(this).select()},"keydown.timepicker":d.proxy(f.widgetKeydown,f),"keyup.timepicker":d.proxy(f.widgetKeyup,f)})})}this.setDefaultTime(this.defaultTime)},blurElement:function(){this.highlightedUnit=null;this.updateFromElementVal()},clear:function(){this.hour="";this.minute="";this.second="";this.meridian="";this.$element.val("")},decrementHour:function(){if(this.showMeridian){if(this.hour===1){this.hour=12}else{if(this.hour===12){this.hour--;return this.toggleMeridian()}else{if(this.hour===0){this.hour=11;return this.toggleMeridian()}else{this.hour--}}}}else{if(this.hour<=0){this.hour=23}else{this.hour--}}},decrementMinute:function(g){var f;if(g){f=this.minute-g}else{f=this.minute-this.minuteStep}if(f<0){this.decrementHour();this.minute=f+60}else{this.minute=f}},decrementSecond:function(){var f=this.second-this.secondStep;if(f<0){this.decrementMinute(true);this.second=f+60}else{this.second=f}},elementKeydown:function(f){switch(f.keyCode){case 9:case 27:this.updateFromElementVal();break;case 37:f.preventDefault();this.highlightPrevUnit();break;case 38:f.preventDefault();switch(this.highlightedUnit){case"hour":this.incrementHour();this.highlightHour();break;case"minute":this.incrementMinute();this.highlightMinute();break;case"second":this.incrementSecond();this.highlightSecond();break;case"meridian":this.toggleMeridian();this.highlightMeridian();break}this.update();break;case 39:f.preventDefault();this.highlightNextUnit();break;case 40:f.preventDefault();switch(this.highlightedUnit){case"hour":this.decrementHour();this.highlightHour();break;case"minute":this.decrementMinute();this.highlightMinute();break;case"second":this.decrementSecond();this.highlightSecond();break;case"meridian":this.toggleMeridian();this.highlightMeridian();break}this.update();break}},getCursorPosition:function(){var g=this.$element.get(0);if("selectionStart" in g){return g.selectionStart}else{if(a.selection){g.focus();var h=a.selection.createRange(),f=a.selection.createRange().text.length;h.moveStart("character",-g.value.length);return h.text.length-f}}},getTemplate:function(){var h,j,g,f,i,k;if(this.showInputs){j='<input type="text" class="bootstrap-timepicker-hour form-control" maxlength="2"/>';g='<input type="text" class="bootstrap-timepicker-minute form-control" maxlength="2"/>';f='<input type="text" class="bootstrap-timepicker-second form-control" maxlength="2"/>';i='<input type="text" class="bootstrap-timepicker-meridian form-control" maxlength="2"/>'}else{j='<span class="bootstrap-timepicker-hour"></span>';g='<span class="bootstrap-timepicker-minute"></span>';f='<span class="bootstrap-timepicker-second"></span>';i='<span class="bootstrap-timepicker-meridian"></span>'}k='<table><tr><td><a href="#" data-action="incrementHour"><i class="glyphicon glyphicon-chevron-up"></i></a></td><td class="separator">&nbsp;</td><td><a href="#" data-action="incrementMinute"><i class="glyphicon glyphicon-chevron-up"></i></a></td>'+(this.showSeconds?'<td class="separator">&nbsp;</td><td><a href="#" data-action="incrementSecond"><i class="glyphicon glyphicon-chevron-up"></i></a></td>':"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td class="meridian-column"><a href="#" data-action="toggleMeridian"><i class="glyphicon glyphicon-chevron-up"></i></a></td>':"")+"</tr><tr><td>"+j+'</td> <td class="separator">:</td><td>'+g+"</td> "+(this.showSeconds?'<td class="separator">:</td><td>'+f+"</td>":"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td>'+i+"</td>":"")+'</tr><tr><td><a href="#" data-action="decrementHour"><i class="glyphicon glyphicon-chevron-down"></i></a></td><td class="separator"></td><td><a href="#" data-action="decrementMinute"><i class="glyphicon glyphicon-chevron-down"></i></a></td>'+(this.showSeconds?'<td class="separator">&nbsp;</td><td><a href="#" data-action="decrementSecond"><i class="glyphicon glyphicon-chevron-down"></i></a></td>':"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td><a href="#" data-action="toggleMeridian"><i class="glyphicon glyphicon-chevron-down"></i></a></td>':"")+"</tr></table>";switch(this.template){case"modal":h='<div class="bootstrap-timepicker-widget modal hide fade in" data-backdrop="'+(this.modalBackdrop?"true":"false")+'"><div class="modal-header"><a href="#" class="close" data-dismiss="modal">×</a><h3>Pick a Time</h3></div><div class="modal-content">'+k+'</div><div class="modal-footer"><a href="#" class="btn btn-primary" data-dismiss="modal">OK</a></div></div>';break;case"dropdown":h='<div class="bootstrap-timepicker-widget dropdown-menu">'+k+"</div>";break}return h},getTime:function(){if(this.hour===""){return""}return this.hour+":"+(this.minute.toString().length===1?"0"+this.minute:this.minute)+(this.showSeconds?":"+(this.second.toString().length===1?"0"+this.second:this.second):"")+(this.showMeridian?" "+this.meridian:"")},hideWidget:function(){if(this.isOpen===false){return}this.$element.trigger({type:"hide.timepicker",time:{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}});if(this.template==="modal"&&this.$widget.modal){this.$widget.modal("hide")}else{this.$widget.removeClass("open")}d(a).off("mousedown.timepicker, touchend.timepicker");this.isOpen=false;this.$widget.detach()},highlightUnit:function(){this.position=this.getCursorPosition();if(this.position>=0&&this.position<=2){this.highlightHour()}else{if(this.position>=3&&this.position<=5){this.highlightMinute()}else{if(this.position>=6&&this.position<=8){if(this.showSeconds){this.highlightSecond()}else{this.highlightMeridian()}}else{if(this.position>=9&&this.position<=11){this.highlightMeridian()}}}}},highlightNextUnit:function(){switch(this.highlightedUnit){case"hour":this.highlightMinute();break;case"minute":if(this.showSeconds){this.highlightSecond()}else{if(this.showMeridian){this.highlightMeridian()}else{this.highlightHour()}}break;case"second":if(this.showMeridian){this.highlightMeridian()}else{this.highlightHour()}break;case"meridian":this.highlightHour();break}},highlightPrevUnit:function(){switch(this.highlightedUnit){case"hour":if(this.showMeridian){this.highlightMeridian()}else{if(this.showSeconds){this.highlightSecond()}else{this.highlightMinute()}}break;case"minute":this.highlightHour();break;case"second":this.highlightMinute();break;case"meridian":if(this.showSeconds){this.highlightSecond()}else{this.highlightMinute()}break}},highlightHour:function(){var f=this.$element.get(0),g=this;this.highlightedUnit="hour";if(f.setSelectionRange){setTimeout(function(){if(g.hour<10){f.setSelectionRange(0,1)}else{f.setSelectionRange(0,2)}},0)}},highlightMinute:function(){var f=this.$element.get(0),g=this;this.highlightedUnit="minute";if(f.setSelectionRange){setTimeout(function(){if(g.hour<10){f.setSelectionRange(2,4)}else{f.setSelectionRange(3,5)}},0)}},highlightSecond:function(){var f=this.$element.get(0),g=this;this.highlightedUnit="second";if(f.setSelectionRange){setTimeout(function(){if(g.hour<10){f.setSelectionRange(5,7)}else{f.setSelectionRange(6,8)}},0)}},highlightMeridian:function(){var f=this.$element.get(0),g=this;this.highlightedUnit="meridian";if(f.setSelectionRange){if(this.showSeconds){setTimeout(function(){if(g.hour<10){f.setSelectionRange(8,10)}else{f.setSelectionRange(9,11)}},0)}else{setTimeout(function(){if(g.hour<10){f.setSelectionRange(5,7)}else{f.setSelectionRange(6,8)}},0)}}},incrementHour:function(){if(this.showMeridian){if(this.hour===11){this.hour++;return this.toggleMeridian()}else{if(this.hour===12){this.hour=0}}}if(this.hour===23){this.hour=0;return}this.hour++},incrementMinute:function(g){var f;if(g){f=this.minute+g}else{f=this.minute+this.minuteStep-(this.minute%this.minuteStep)}if(f>59){this.incrementHour();this.minute=f-60}else{this.minute=f}},incrementSecond:function(){var f=this.second+this.secondStep-(this.second%this.secondStep);if(f>59){this.incrementMinute(true);this.second=f-60}else{this.second=f}},mousewheel:function(g){if(this.disableMousewheel){return}g.preventDefault();g.stopPropagation();var h=g.originalEvent.wheelDelta||-g.originalEvent.detail,f=null;if(g.type==="mousewheel"){f=(g.originalEvent.wheelDelta*-1)}else{if(g.type==="DOMMouseScroll"){f=40*g.originalEvent.detail}}if(f){g.preventDefault();d(this).scrollTop(f+d(this).scrollTop())}switch(this.highlightedUnit){case"minute":if(h>0){this.incrementMinute()}else{this.decrementMinute()}this.highlightMinute();break;case"second":if(h>0){this.incrementSecond()}else{this.decrementSecond()}this.highlightSecond();break;case"meridian":this.toggleMeridian();this.highlightMeridian();break;default:if(h>0){this.incrementHour()}else{this.decrementHour()}this.highlightHour();break}return false},place:function(){if(this.isInline){return}var h=this.$widget.outerWidth(),o=this.$widget.outerHeight(),j=10,l=d(c).width(),g=d(c).height(),k=d(c).scrollTop();var r=parseInt(this.$element.parents().filter(function(){}).first().css("z-index"),10)+10;var n=this.component?this.component.parent().offset():this.$element.offset();var s=this.component?this.component.outerHeight(true):this.$element.outerHeight(false);var i=this.component?this.component.outerWidth(true):this.$element.outerWidth(false);var m=n.left,q=n.top;this.$widget.removeClass("timepicker-orient-top timepicker-orient-bottom timepicker-orient-right timepicker-orient-left");if(this.orientation.x!=="auto"){this.picker.addClass("datepicker-orient-"+this.orientation.x);if(this.orientation.x==="right"){m-=h-i}}else{this.$widget.addClass("timepicker-orient-left");if(n.left<0){m-=n.left-j}else{if(n.left+h>l){m=l-h-j}}}var f=this.orientation.y,p,t;if(f==="auto"){p=-k+n.top-o;t=k+g-(n.top+s+o);if(Math.max(p,t)===t){f="top"}else{f="bottom"}}this.$widget.addClass("timepicker-orient-"+f);if(f==="top"){q+=s}else{q-=o+parseInt(this.$widget.css("padding-top"),10)}this.$widget.css({top:q,left:m,zIndex:r})},remove:function(){d("document").off(".timepicker");if(this.$widget){this.$widget.remove()}delete this.$element.data().timepicker},setDefaultTime:function(h){if(!this.$element.val()){if(h==="current"){var f=new Date(),g=f.getHours(),j=f.getMinutes(),k=f.getSeconds(),i="AM";if(k!==0){k=Math.ceil(f.getSeconds()/this.secondStep)*this.secondStep;if(k===60){j+=1;k=0}}if(j!==0){j=Math.ceil(f.getMinutes()/this.minuteStep)*this.minuteStep;if(j===60){g+=1;j=0}}if(this.showMeridian){if(g===0){g=12}else{if(g>=12){if(g>12){g=g-12}i="PM"}else{i="AM"}}}this.hour=g;this.minute=j;this.second=k;this.meridian=i;this.update()}else{if(h===false){this.hour=0;this.minute=0;this.second=0;this.meridian="AM"}else{this.setTime(h)}}}else{this.updateFromElementVal()}},setTime:function(k,i){if(!k){this.clear();return}var j,f,l,g,h;if(typeof k==="object"&&k.getMonth){f=k.getHours();l=k.getMinutes();g=k.getSeconds();if(this.showMeridian){h="AM";if(f>12){h="PM";f=f%12}if(f===12){h="PM"}}}else{if(k.match(/p/i)!==null){h="PM"}else{h="AM"}k=k.replace(/[^0-9\:]/g,"");j=k.split(":");f=j[0]?j[0].toString():j.toString();l=j[1]?j[1].toString():"";g=j[2]?j[2].toString():"";if(f.length>4){g=f.substr(4,2)}if(f.length>2){l=f.substr(2,2);f=f.substr(0,2)}if(l.length>2){g=l.substr(2,2);l=l.substr(0,2)}if(g.length>2){g=g.substr(2,2)}f=parseInt(f,10);l=parseInt(l,10);g=parseInt(g,10);if(isNaN(f)){f=0}if(isNaN(l)){l=0}if(isNaN(g)){g=0}if(this.showMeridian){if(f<1){f=1}else{if(f>12){f=12}}}else{if(f>=24){f=23}else{if(f<0){f=0}}if(f<13&&h==="PM"){f=f+12}}if(l<0){l=0}else{if(l>=60){l=59}}if(this.showSeconds){if(isNaN(g)){g=0}else{if(g<0){g=0}else{if(g>=60){g=59}}}}}this.hour=f;this.minute=l;this.second=g;this.meridian=h;this.update(i)},showWidget:function(){if(this.isOpen){return}if(this.$element.is(":disabled")){return}this.$widget.appendTo(this.appendWidgetTo);var f=this;d(a).on("mousedown.timepicker, touchend.timepicker",function(g){if(!(f.$element.parent().find(g.target).length||f.$widget.is(g.target)||f.$widget.find(g.target).length)){f.hideWidget()}});this.$element.trigger({type:"show.timepicker",time:{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}});this.place();if(this.disableFocus){this.$element.blur()}if(this.hour===""){if(this.defaultTime){this.setDefaultTime(this.defaultTime)}else{this.setTime("0:0:0")}}if(this.template==="modal"&&this.$widget.modal){this.$widget.modal("show").on("hidden",d.proxy(this.hideWidget,this))}else{if(this.isOpen===false){this.$widget.addClass("open")}}this.isOpen=true},toggleMeridian:function(){this.meridian=this.meridian==="AM"?"PM":"AM"},update:function(f){this.updateElement();if(!f){this.updateWidget()}this.$element.trigger({type:"changeTime.timepicker",time:{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}})},updateElement:function(){this.$element.val(this.getTime()).change()},updateFromElementVal:function(){this.setTime(this.$element.val())},updateWidget:function(){if(this.$widget===false){return}var f=this.hour,h=this.minute.toString().length===1?"0"+this.minute:this.minute,g=this.second.toString().length===1?"0"+this.second:this.second;if(this.showInputs){this.$widget.find("input.bootstrap-timepicker-hour").val(f);this.$widget.find("input.bootstrap-timepicker-minute").val(h);if(this.showSeconds){this.$widget.find("input.bootstrap-timepicker-second").val(g)}if(this.showMeridian){this.$widget.find("input.bootstrap-timepicker-meridian").val(this.meridian)}}else{this.$widget.find("span.bootstrap-timepicker-hour").text(f);this.$widget.find("span.bootstrap-timepicker-minute").text(h);if(this.showSeconds){this.$widget.find("span.bootstrap-timepicker-second").text(g)}if(this.showMeridian){this.$widget.find("span.bootstrap-timepicker-meridian").text(this.meridian)}}},updateFromWidgetInputs:function(){if(this.$widget===false){return}var f=this.$widget.find("input.bootstrap-timepicker-hour").val()+":"+this.$widget.find("input.bootstrap-timepicker-minute").val()+(this.showSeconds?":"+this.$widget.find("input.bootstrap-timepicker-second").val():"")+(this.showMeridian?this.$widget.find("input.bootstrap-timepicker-meridian").val():"");this.setTime(f,true)},widgetClick:function(g){g.stopPropagation();g.preventDefault();var h=d(g.target),f=h.closest("a").data("action");if(f){this[f]()}this.update();if(h.is("input")){h.get(0).setSelectionRange(0,2)}},widgetKeydown:function(g){var h=d(g.target),f=h.attr("class").replace("bootstrap-timepicker-","");switch(g.keyCode){case 9:if((this.showMeridian&&f==="meridian")||(this.showSeconds&&f==="second")||(!this.showMeridian&&!this.showSeconds&&f==="minute")){return this.hideWidget()}break;case 27:this.hideWidget();break;case 38:g.preventDefault();switch(f){case"hour":this.incrementHour();break;case"minute":this.incrementMinute();break;case"second":this.incrementSecond();break;case"meridian":this.toggleMeridian();break}this.setTime(this.getTime());h.get(0).setSelectionRange(0,2);break;case 40:g.preventDefault();switch(f){case"hour":this.decrementHour();break;case"minute":this.decrementMinute();break;case"second":this.decrementSecond();break;case"meridian":this.toggleMeridian();break}this.setTime(this.getTime());h.get(0).setSelectionRange(0,2);break}},widgetKeyup:function(f){if((f.keyCode===65)||(f.keyCode===77)||(f.keyCode===80)||(f.keyCode===46)||(f.keyCode===8)||(f.keyCode>=46&&f.keyCode<=57)){this.updateFromWidgetInputs()}}};d.fn.timepicker=function(g){var f=Array.apply(null,arguments);f.shift();return this.each(function(){var j=d(this),i=j.data("timepicker"),h=typeof g==="object"&&g;if(!i){j.data("timepicker",(i=new b(this,d.extend({},d.fn.timepicker.defaults,h,d(this).data()))))}if(typeof g==="string"){i[g].apply(i,f)}})};d.fn.timepicker.defaults={defaultTime:"current",disableFocus:false,disableMousewheel:false,isOpen:false,minuteStep:15,modalBackdrop:false,orientation:{x:"auto",y:"auto"},secondStep:15,showSeconds:false,showInputs:true,showMeridian:true,template:"dropdown",appendWidgetTo:"body",showWidgetOnAddonClick:true};d.fn.timepicker.Constructor=b})(jQuery,window,document);"use strict";var attach_pickers,validate_node,GtdHeading;function ow_waiting(f,g){var e,c,a,d,b;c=/(\w+)?\.?(\w+)?/;a=c.exec(f);d=a[1];b=a[2];e=$("body").data("ow-waiting");if(e===undefined){e={};$("body").prepend('<div id="loading"></div>');e.$loading=$("#loading");e.$loading.hide();e.$loading.append('<div id="mask"></div>');e.$mask=e.$loading.find("#mask");e.$mask.append('<div id="dark"></div>');e.$mask.append('<img id="spinner" alt="loading" src="/static/ajax-loader.gif"></img>');$("body").data("ow-waiting",e)}if(d==="clear"){e.$loading.fadeOut()}else{e.$mask.hide();e.$loading.show(g);if(d==="spinner"){e.$mask.fadeIn()}}}var persona_user;$(document).ready(function(){function a(c){var g,f,e,d;g=null;if(document.cookie&&document.cookie!==""){f=document.cookie.split(";");for(e=0;e<f.length;e+=1){d=jQuery.trim(f[e]);if(d.substring(0,c.length+1)===(c+"=")){g=decodeURIComponent(d.substring(c.length+1));break}}}return g}var b=a("csrftoken");$.ajaxSetup({beforeSend:function(c){c.setRequestHeader("X-CSRFToken",b)},dataType:"json",})});(function(a){a.fn.alohaText=function(b){var c=this;if(typeof b!=="object"){b={}}b.$element=c;if(typeof b.$parent==="undefined"){b.$parent=b.$element.parent()}Aloha.ready(function(){var d=Aloha.jQuery(c);d.aloha()});c.data("alohaText",b);return this};a("document").ready(function(){Aloha.ready(function(){console.log("# Todo: Switch Aloha editor to PubSub");Aloha.bind("aloha-editable-activated",function(g,c){var d,b,f;d=c.editable;f=a(d.obj.context);b=f.data("alohaText");if(b){b.old_text=d.snapshotContent}});Aloha.bind("aloha-editable-deactivated",function(g,j){var d,h,k,f,b,c,i;d=j.editable;h=a(d.obj.context);k=h.data("alohaText");if(k){if(k.old_text!==d.obj.html()){f=k.$parent;b="/gtd/node/"+f.attr("node_id")+"/";c=h.html();if(c==="<br>"){c=""}i={format:"json",node_id:f.attr("node_id"),text:c};a.post(b,i,function(m){var e=[],l;m=a.parseJSON(a.parseJSON(m))[0];if(k.heading){k.heading.set_fields(m)}else{l=f.data("nodeOutline");if(l){e=f.data("nodeOutline").$buttons.find("#edit-modal")}}})}}})})})}(jQuery));(function(a){a.fn.nodeList=function(b){this.find(".list-node").each(function(){var e,d,c;e=a(this).attr("node_id");d=a(this).find(".todo-state");c=d.attr("todo_id");if(c===""){d.attr("todo_id",0);d.html('<span class="todo-none">[None]</span>\n')}d.todoState({states:b.states,node_id:e})});return this}}(jQuery));(function(a){a.fn.agenda=function(j){var k,f,i,c,g,b,e,d,h;k=this.find("form.date");f=k.find('input[name="date"][type="text"]');i=this;if(!this.data("agenda")){this.data("agenda",{})}c=a.extend(this.data("agenda"),j);g=function(o){var p,l,n,r,m,q;p=/(\d{4})-([01]?\d)-([0-3]?\d)/;l=p.exec(o);if(l){n=Number(l[1]);r=Number(l[2])-1;m=Number(l[3]);q=new Date(n,r,m)}else{q=undefined}return q};c.date=g(this.attr("date"));if(!c.date){b=new Date();e=new Date(b.getFullYear(),b.getMonth(),b.getDate());c.date=e}this.data("agenda",c);d=function(){var l="/gtd/agenda/"+c.date.getFullYear()+"-"+(c.date.getMonth()+1)+"-"+c.date.getDate()+"/";a.getJSON(l,{format:"json"},function(n){var o,m;if(n.status==="success"){i.find(".daily").html(n.daily_html);i.find(".timely").html(n.timely_html);i.find(".deadlines").html(n.deadlines_html);o="";m=["Jan.","Feb.","Mar.","Apr.","May","Jun.","Jul.","Aug.","Sep.","Oct.","Nov.","Dec."];o+=m[c.date.getMonth()]+" ";o+=c.date.getDate()+", ";o+=c.date.getFullYear();i.children(".date:header").html(o);h()}})};k.bind("submit",function(){var l=g(f.val());if(l){c.date=l;i.data("agenda",c);d()}else{jQuery.error("Improperly formatted date: "+f.val())}return false});h=function(){i.find(".todo-state").each(function(){var l=a(this).parent().attr("node_id");a(this).todoState({states:c.states,node_id:l,click:function(){d()}})})};h();return this}}(jQuery));(function(b){var a={init:function(c){return this.each(function(){var m,e,l,f,h,o,q,d,g,p,j,r,k,n;e=b(this);l=e.data("todoState");if(!l){e.find("a").contents().unwrap();f=e.attr("todo_id");h=b.extend({states:[{pk:0,display:"[None]"},],todo_id:f,node_id:0,click:function(){},parent_elem:e.parent()},c);o=function(u){var t,s;t={pk:-1,display:"",full:""};for(s=0;s<h.states.length;s+=1){if(h.states[s].pk===u){t=h.states[s]}}return t};h.get_todo_id=function(){var i;if(this.heading){i=this.heading.todo_state}else{i=this.todo_id}return Number(i)};q=o(f);d=function(){j.hide();e.unbind(".autohide")};g=function(){j.show();b("body").one("click.autohide",function(){d()});j.bind("click",function(i){i.stopPropagation()});e.bind("click.autohide",function(){d()})};e.tooltip({delay:{show:1000,hide:100},title:"click to change",placement:"right"});e.attr("data-original-title",q.full);p="";p+='<div class="popover right todostate">\n';p+='  <div class="arrow"></div>\n';p+='  <div class="popover-title">Todo State</div>\n';p+='  <div class="popover-inner">\n';p+="  </div>\n";p+="</div>\n";e.after(p);j=e.next(".popover");r=j.children(".popover-inner");j.hide();j.css("position","absolute");for(m=0;m<h.states.length;m+=1){k="";k+='<div class="todo-option"';k+=' todo_id="';k+=h.states[m].pk;k+='"';if(h.states[m].pk===h.get_todo_id()){k+=" selected"}k+=">";k+=h.states[m].display;k+="</div>\n";r.append(k)}e.bind("click",function(v){var s,u,i,t,x,w;v.stopPropagation();b(".popover.todostate").hide();e=b(this);e.tooltip("hide");s=e.position().left+e.width();j.css("left",s+"px");u=e.position().top;i=e.height();t=u+(i/2);x=t-(j.height()/2);j.css("top",x+"px");if(h.heading){w=h.heading.todo_state;j.find(".todo-option").removeAttr("selected");j.find('.todo-option[todo_id="'+w+'"]').attr("selected","selected")}g()});n=r.children(".todo-option");n.mouseenter(function(){if(!b(this).attr("selected")){b(this).addClass("ow-hover")}});n.mouseleave(function(){b(this).removeClass("ow-hover")});n.bind("click",function(){var i,t,v,s,u;i=Number(b(this).attr("todo_id"));t=b(this).parent().parent();v=t.parent().parent().data("nodeOutline");s="/gtd/node/"+h.node_id+"/";u={fields:{todo_state:i,auto_update:true,},};u=JSON.stringify(u);if(i!==h.get_todo_id()){b.ajax(s,{data:u,type:"PUT",contentType:"application/json",success:function(x){var A,w,y,z;while(typeof x==="string"){x=b.parseJSON(x)}x=x[0];if(h.heading){h.heading.set_fields(x);h.heading.redraw()}else{w=e.attr("todo_id");e.attr("todo_id",x.fields.todo_state);f=x.fields.todo_state;h.todo_id=x.fields.todo_state}y=o(x.fields.todo_state);e.html(y.display);e.attr("data-original-title",y.full);n.removeAttr("selected");z='.todo-option[todo_id="';z+=x.todo_id+'"]';r.children(z).attr("selected","");if(x.fields.repeats){alert("Node scheduled for "+x.fields.scheduled.slice(0,10))}h.click(x);e.mouseenter();e.mouseleave()}});d()}});e.data("todoState",h)}})},update:function(c){this.each(function(){var i,h,g,e,d,f;i=b(this);h=i.data("todoState");g=i.next(".popover");if(typeof c.todo_state!=="undefined"){h.todo_state=c.todo_state;i.attr("todo_id",c.todo_state);e=".todo-option";d=e+'[todo_id="'+c.todo_state+'"]';g.find(e).removeAttr("selected");g.find(d).attr("selected","selected");f=h.states.filter(function(j){return j.pk===Number(c.todo_state)})[0];i.html(f.display);if(h.todo_state>0){i.show()}else{i.hide()}}i.data("todoState",h)})}};b.fn.todoState=function(d){var c;if(a[d]){c=a[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){c=a.init.apply(this,arguments)}else{b.error("Method "+d+" does not exist on jQuery.todoState")}}return c}}(jQuery));"use strict";var GtdHeading,HeadingManager;GtdHeading=function(b){var c,d,a;if(!b){b={}}this.fields={archived:false,priority:"B",scope:[],text:"",title:"",todo_state:null,tree_id:null,};this.pk=0;this.archived=false;this.populated=false;this.expandable="lazy";this.rank=1;this.state="closed";this.visible=false;this.children=new HeadingManager(b.workspace);this.set_fields(b);this.parent_obj=this.get_parent();if(this.workspace){if(this.parent_obj){this.rank=this.parent_obj.rank+1}}};GtdHeading.prototype.set_fields=function(f){var g,h,e,c,b;b=$.extend({},f);e=/^\d{4}-\d{2}-\d{2}[0-9:TZ]*/;if(b.id!==undefined){this.pk=Number(b.id);delete b.id}if(b.workspace!==undefined){this.workspace=b.workspace;delete b.workspace}this.model=b.model;delete b.model;try{if(b.parent===this.pk){throw"bad parent"}}catch(a){if(a==="bad parent"){console.error("Cannot create node as a child of itself");throw a}}jQuery.extend(this.fields,b)};GtdHeading.prototype.get_todo_state=function(){var d,b,c,a;d=null;if(typeof this.workspace!=="undefined"){for(b=0;b<this.workspace.todo_states.length;b+=1){c=this.workspace.todo_states[b];if(c.pk===Number(this.todo_state)){d=c}}}if(d){a=d}else{a={pk:this.todo_state}}return a};GtdHeading.prototype.get_title=function(){var a;a=this.title;if(this.archived){a='<span class="archived-text">'+a+"</span>"}return a};GtdHeading.prototype.get_previous_sibling=function(){var b,c,a;b=null;if(this.level===0){c=this.fields.tree_id;while(c>1&&b===null){c=c-1;b=this.workspace.headings.get({tree_id:c,level:0,})}}else{a=this.fields.lft;a=a-2;while(a>1&&b===null){b=this.workspace.headings.get({tree_id:this.fields.tree_id,parent:this.fields.parent,lft:a,})}}return b};GtdHeading.prototype.get_parent=function(){var a;if(this.rank>0&&this.workspace){if(this.fields.parent===null){a=this.workspace}else{a=this.workspace.headings.get({pk:this.fields.parent})}}else{a=null}return a};GtdHeading.prototype.get_children=function(){var a;if(this.rank===0){a=this.workspace.headings.filter_by({rank:1})}else{a=this.workspace.headings.filter_by({parent:this.pk}).order_by("lft")}return a};GtdHeading.prototype.refresh_tree=function(){var a,b,c,d;a="/gtd/tree/"+this.fields.tree_id+"/";c=this;$.get(a,function(e){while(typeof e==="string"){e=$.parseJSON(e)}for(b=0;b<e.length;b+=1){d=new GtdHeading(e[b]);c.workspace.headings.add(d)}})};GtdHeading.prototype.is_leaf_node=function(){var a;if(this.fields.rght-this.fields.lft===1){a=true}else{if(this.fields.rght-this.fields.lft>1){a=false}else{a=undefined}}return a};GtdHeading.prototype.is_expandable=function(){var b,c,a;b=false;if(this.rank===0){b=true}if(this.text){b=true}else{if(this.workspace.show_all){if(this.workspace.active_scope){b=this.get_children().filter_by({scope:this.workspace.active_scope}).length}else{b=!this.is_leaf_node()}}else{c=this.get_children();if(this.workspace.active_scope){c=c.filter_by({scope:this.workspace.active_scope})}if(c.filter_by({archived:false}).length){b=true}else{if(this.populated===false&&!this.is_leaf_node()){b=true}}}}if(b){a=true}else{a=false}return a};GtdHeading.prototype.is_visible=function(i){var b,e,j,c,f,d,k,g,h,a;b=true;this.update();if(this.workspace.active_scope){if(this.fields.scope.indexOf(this.workspace.active_scope)===-1){b=false}}j=this.workspace.active_states;if(typeof j!=="undefined"){f=true;if(j.indexOf(this.fields.todo_state)===-1){f=false}d=this.just_modified||false;k=this.todo_state?this.todo_state.fields.closed:false;if(this.fields.deadline_date&&!k){g=7;h=g*24*60*60*1000;a=(this.due()<h)}else{a=false}if(!f&&!a&&!d){b=false}}e=this.workspace?this.workspace.show_arx:false;if(this.fields.archived&&!e){b=false}c=this.workspace.active_root;if(c){if(c.fields.tree_id!==this.fields.tree_id){b=false}}if(this.parent_obj&&!this.workspace.show_list){if(this.parent_obj.state!=="open"){b=false}}if(this.pk===-1){b=false}return b};GtdHeading.prototype.due=function(){var c,a,b;c=null;if(this.fields.deadline_date){a=new Date();b=new Date(this.fields.deadline_date);c=b-a}return c};GtdHeading.prototype.update=function(){var a;a=/\S+/;if(a.test(this.fields.text)){this.expandable="yes"}else{if(this.populated){if(this.children.length>0){this.expandable="yes"}else{this.expandable="no"}}}this.todo_state=this.workspace.todo_states.get({pk:this.fields.todo_state});this.children=this.workspace.headings.filter_by({parent:this.pk});this.parent_obj=this.get_parent()};GtdHeading.prototype.save=function(b){var a,f,d,c,e;e=this;if(b===undefined){b={}}c=b.auto?true:false;a="/gtd/node/";e.fields.auto_update=c;d=jQuery.extend({},e.fields,{id:e.pk});if(e.pk>0){a+=e.pk+"/";f="PUT"}else{f="POST"}jQuery.ajax(a,{type:f,data:JSON.stringify(d),contentType:"application/json",success:function(i,g,h){e.workspace.$apply(function(){var j;if(typeof i==="string"){i=jQuery.parseJSON(i)}e.pk=i.pk;e.set_fields(i);e.update()})},error:function(i,g,h){alert("Not saved");console.error(i.responseText)},})};GtdHeading.prototype.move_to=function(h,d){var g,c,b,a,f,e;g=this;b=true;if(d===undefined){d={}}if(d.position===undefined){d.position="first-child"}if(d.save===undefined){d.save=false}a=function(){var i=true;if(g.fields.tree_id===h.fields.tree_id){if(g===h){console.error("GtdHeading refusing to move relative to itself");i=false}else{if(h.fields.lft>g.fields.lft&&h.fields.rght<g.fields.rght){console.error("GtdHeading refusing to move relative to its own child");i=false}}}return i};f=function(){var i=a();if(i===true){g.fields.parent=h.pk;g.fields.tree_id=h.fields.tree_id;g.level=h.level+1;g.rank=h.rank+1}return i};e=function(){var i=a();if(i===true){g.fields.parent=h.fields.parent;g.fields.tree_id=h.fields.tree_id;g.level=h.level;g.rank=h.rank}return i};c={"first-child":function(){var i=f();if(i===true){g.fields.lft=-1}return i},"last-child":function(){var j,i;j=f();if(j===true){i=h.get_children();g.fields.lft=i[i.length-1].fields.lft+1}return j},left:function(){var i=e();if(i===true){g.fields.lft=h.fields.lft-1}return i},right:function(){var i=e();if(i===true){g.fields.lft=h.fields.lft+1}return i}};if(typeof c[d.position]==="function"){b=c[d.position]()}else{b=false}if(b===true){h.update();g.rebuild()}return b};GtdHeading.prototype.rebuild=function(){var a,b;a=this.workspace.headings.get({tree_id:this.fields.tree_id,rank:1});b=function(f,g){var e,c,d;f.fields.lft=g;e=f.get_children();c=g+1;for(d=0;d<e.length;d+=1){c=b(e[d],c)+1}f.fields.rght=c;return c};if(a.fields.lft===undefined){a.fields.lft=1}b(a,a.fields.lft)};GtdHeading.prototype.has_scope=function(b){var a;if(b===0){a=true}else{if((b===-1)&&(this.scope.length===0)){a=true}else{if(jQuery.inArray(b,this.scope)>-1){a=true}else{a=false}}}return a};GtdHeading.prototype.set_indent=function(b,c){var a=(this.icon_width+4)*c;b.css("margin-left",a+"px")};GtdHeading.prototype.populate_children=function(b){var a,c,d;if(typeof b==="undefined"){b={}}a="/gtd/node/";c=this;d=function(e){var f,g;g=c.fields.level+e.offset;f={level:g,tree_id:c.fields.tree_id,rght__lt:c.fields.rght,lft__gt:c.fields.lft,};$.getJSON(a,f,function(i,h,j){c.workspace.$apply(function(){var k,l,n,o,m;if(h==="success"){k=i;for(l=0;l<k.length;l+=1){n=k[l];n.workspace=c.workspace;o=new GtdHeading(n);m=o.get_parent();if(m||o.rank===1){o=c.workspace.headings.add(o)}if(m){m.children.add(o);if(m.state==="open"){o.visible=true}}}if(c.rank===0){c.populated=true}if(e.offset===1){c.populated=true;c.update()}else{if(e.offset===2){for(l=0;l<c.children.length;l+=1){c.children[l].populated=true;c.children[l].update()}}}if(e.callback){e.callback()}}})})};if(!this.populated){if(this.rank>0&&this.$children){this.$children.hide()}d({offset:1,callback:function(){if(!c.populated_level_2){d({offset:2});c.populated_level_2=true}}})}else{if(!this.populated_level_2){d({offset:2});this.populated_level_2=true}}};GtdHeading.prototype.toggle=function(a){this.populate_children();if(typeof a!=="undefined"){this.state=a}else{if(this.state==="open"){this.state="closed"}else{if(this.state==="closed"){this.state="open"}}}};var HeadingManager=function(a){var b=[];b.workspace=a;return b};Array.prototype.get=function(c){var b,a;a=this.filter_by(c);if(a.length===1){b=a[0]}else{if(a.length>1){console.error("HeadingManager.get():query did not produce unique result. Returning first result");console.log(c);console.log(a);b=a[0]}else{b=null}}return b};Array.prototype.filter_by=function(g){var a,c,e,f,b,d;a=[];a.workspace=this.workspace;for(c=0;c<this.length;c+=1){e=this[c];if(e.rank===0){f=false}else{f=true}for(b in g){if(g.hasOwnProperty(b)){if(typeof e.fields!=="undefined"){if(Object.keys(e.fields).indexOf(b)>-1){d=e.fields}else{d=e}}else{d=e}if(d[b] instanceof Array){if(g[b] instanceof Array){if(!(($(e.scope).not([]).length===0&&$([]).not(e.scope).length===0)&&typeof e.scope!=="undefined")){f=false}}else{if(jQuery.inArray(g[b],d[b])<0){f=false}}}else{if(d[b]!==g[b]){f=false}}}}if(f){a.push(e)}}return a};Array.prototype.order_by=function(e){var a,b,d,c;a=/^(-)?(\S*)$/.exec(e);c=a[2];b=this.slice(0);d=function(g,f){var l,i,k,j,h;if(typeof g.fields==="undefined"||typeof f.fields==="undefined"){l=g[c];i=f[c]}else{if(g.fields.hasOwnProperty(c)&&f.fields.hasOwnProperty(c)){l=g.fields[c];i=f.fields[c]}else{l=g[c];i=f[c]}}k=Number(l);j=Number(i);if(k&&j){h=k-j}else{l=l.toUpperCase();i=i.toUpperCase();if(l<i){h=-1}else{if(l>i){h=1}else{h=0}}}return h};b.sort(d);if(a[1]==="-"){b.reverse()}return b};Array.prototype.add=function(g){var d,f,c,a,e,h,b;d=this;c=["pk","populated","text","todo_state","archived","rank","scope","parent"];e=function(k){var i,j;i=[];j=function(m){var l;f=d.get({pk:m.pk});if(f){m.populated=f.populated;for(l in m.fields){if(m.fields.hasOwnProperty(l)){f.fields[l]=m.fields[l]}}a=f}else{m.workspace=d.workspace;d.push(m);a=m}a.update();i.push(a.get_parent());return a};if(k instanceof Array){for(b=0;b<k.length;b+=1){h=new GtdHeading(k[b]);j(h)}}else{a=j(k)}i=i.filter(function(n,m,l){return l.lastIndexOf(n)===m});for(b=0;b<i.length;b+=1){if(i[b]){i[b].update()}}};if(g.$resolved===false){g.$promise.then(e)}else{e(g)}return a};Array.prototype.remove=function(c){var a,b;b=false;a=this.indexOf(c);if(a>-1){this.splice(a,1);b=true}return b};Date.prototype.ow_date=function(){var a;a=this.getFullYear()+"-"+(this.getMonth()+1)+"-"+this.getDate();return a};"use strict";var test_headings,owConfig,HeadingFactory,GtdListFactory,UpcomingFactory,outlineCtrl,listCtrl,ow_waiting;var gtd_module=angular.module("orgWolf",["ngAnimate","ngResource","ngSanitize"]);gtd_module.config(["$httpProvider","$locationProvider",owConfig]);function owConfig(d,b){d.defaults.headers.common["X-Request-With"]="XMLHttpRequest";function a(e){var j,h,g,f;j=null;if(document.cookie&&document.cookie!==""){h=document.cookie.split(";");for(g=0;g<h.length;g+=1){f=jQuery.trim(h[g]);if(f.substring(0,e.length+1)===(e+"=")){j=decodeURIComponent(f.substring(e.length+1));break}}}return j}var c=a("csrftoken");$.ajaxSetup({beforeSend:function(e){e.setRequestHeader("X-CSRFToken",c)}})}gtd_module.factory("OldHeading",["$resource","$http",function(a,b){return function(c){return new GtdHeading(c)}}]);gtd_module.factory("Heading",["$resource","$http",HeadingFactory]);function HeadingFactory(b,c){var a=b("/gtd/node/:pk/",{pk:"@pk"},{query:{method:"GET",transformResponse:c.defaults.transformResponse.concat([function(e,d){return e}]),isArray:true},});return a}gtd_module.factory("Upcoming",["$resource","$http",UpcomingFactory]);function UpcomingFactory(b,c){var a=b("/gtd/node/upcoming/",{},{query:{method:"GET",transformResponse:c.defaults.transformResponse.concat([function(e,d){return e}]),isArray:true},});return a}gtd_module.factory("GtdList",["$resource","$http",GtdListFactory]);function GtdListFactory(b,c){var a=b("/gtd/lists/",{},{query:{method:"GET",transformResponse:c.defaults.transformResponse.concat([function(f,e){var d,g;for(d=0;d<f.length;d+=1){g=new GtdHeading(f[d]);jQuery.extend(f[d],g)}return f}]),isArray:true},});return a}gtd_module.filter("style",function(){return function(e){var d,f,a,b;d="";if(e===null||e===undefined){d=null}else{if(e.model==="gtd.todostate"){f={};f.RED_OFFSET=16;f.GREEN_OFFSET=8;f.BLUE_OFFSET=0;f.RED_MASK=16711680;f.GREEN_MASK=65280;f.BLUE_MASK=255;f.red=(e.fields._color_rgb&f.RED_MASK)>>f.RED_OFFSET;f.green=(e.fields._color_rgb&f.GREEN_MASK)>>f.GREEN_OFFSET;f.blue=(e.fields._color_rgb&f.BLUE_MASK)>>f.BLUE_OFFSET;d+="color: rgba("+f.red+", "+f.green+", "+f.blue;d+=", "+e.fields._color_alpha+"); ";if(e.fields.actionable){d+="font-weight: bold; "}}else{a=["rgb(88, 0, 176)","rgb(80, 0, 0)","rgb(0, 44, 19)","teal","slateblue","brown"];b=(e.fields.level)%a.length;d+="color: "+a[b]+"; "}}return d}});gtd_module.filter("asHtml",["$sce",function(a){return function(c){var b=a.trustAsHtml(c);return b}}]);gtd_module.filter("order",["$sce",function(a){return function(f,e){var c,d,b;if(e==="list"){b=f.filter_by({deadline_date:null});d=$(f).not(b).get().order_by("deadline_date");c=d;c=c.concat(b.order_by("priority"))}else{c=f.order_by(e)}return c}}]);gtd_module.filter("root_cell",["$sce",function(a){return function(d){var c,b;b="";c=d.workspace.parents.get({tree_id:d.fields.tree_id,level:0});if(c){b+="<a>";b+=c.fields.title+"</a>"}b=a.trustAsHtml(b);return b}}]);gtd_module.filter("deadline_str",["$sce",function(a){return function(e){var f,c,b,d,g;f="";if(e.fields.deadline_date){f="Due ";c=new Date(e.fields.deadline_date+"T12:00:00");b=new Date();b.setHours(12,0,0,0);d=c.getTime()-b.getTime();g=Math.ceil(d/(1000*3600*24));if(g===0){f+="today"}else{if(g===-1){f+="yesterday"}else{if(g<0){f+=Math.abs(g)+" days ago"}else{if(g===1){f+="tomorrow"}else{if(g>0){f+="in "+g+" days"}}}}}}return f}}]);gtd_module.directive("owEditable",function(){function a(f,d,c){var e,g,b;f.fields=jQuery.extend(true,{},f.heading.fields);f.priorities=[{sym:"A",display:"A - high"},{sym:"B",display:"B - medium (default)"},{sym:"C",display:"C - low"}];f.time_units=[{value:"d",label:"Days"},{value:"w",label:"Weeks"},{value:"m",label:"Months"},{value:"y",label:"Years"},];f.repeat_schemes=[{value:false,label:"scheduled date"},{value:true,label:"completion date"},];e=d.find(".edit-text");b=d.find("#edit-save");$("body").animate({scrollTop:d.offset().top-27},"500");d.find(".make-switch").each(function(){var h;h=$(this).find("input").attr("ng-model").split(".")[1];$(this).bootstrapSwitch();$(this).bootstrapSwitch("setState",f.fields[h])});d.find(".make-switch").on("switch-change",function(j,h){var i;i=$(j.target).find("input").attr("ng-model").split(".")[1];f.fields[i]=h.value});d.find(".datepicker").datepicker({format:"yyyy-mm-dd",});d.find(".timepicker").timepicker({showMeridian:false,showSeconds:true,});d.find(".timepicker,.datepicker").on("change",function(j){var h,i;h=$(j.target);i=h.attr("ng-model").split(".")[1];f.fields[i]=h.val()});d.find("#title").focus();f.save=function(h){f.fields.text=d.find(".edit-text")[0].innerHTML;f.heading.fields=f.fields;f.heading.update();f.heading.editable=false;f.heading.save()};f.cancel_edit=function(h){f.heading.editable=false;if(f.heading.pk===0){f.heading.pk=-1}};Aloha.ready(function(){Aloha.jQuery(d.find(".edit-text")).aloha()})}return{link:a}});gtd_module.directive("owScopeTabs",["$resource",function(a){function b(f,e,d){var c;c=a("/gtd/scope/");f.scopes=c.query();e.addClass("nav").addClass("nav-tabs");e.find('[scope_id="'+f.active_scope+'"]').addClass("active");f.change_scope=function(h){var g;e.find('[scope_id="'+f.active_scope+'"]').removeClass("active");f.active_scope=parseInt($(h.currentTarget).attr("scope_id"),10);e.find('[scope_id="'+f.active_scope+'"]').addClass("active")}}return{link:b}}]);gtd_module.directive("owTodo",["$filter",function(b){function a(o,g,n){var h,m,f,j,d,l,p,c;c=b("style");o.heading.todo_popover=false;m=g.children("span");if(o.heading.todo_state){m.tooltip({delay:{show:1000,hide:100},title:o.heading.todo_state.fields.display_text,placement:"right"})}function e(i){g.popover("destroy")}function k(i){$("body").append('<div id="todo-popover"></div>');l='<div class="todo-option" todo_id=""';if(o.heading.fields.todo_state===null){l+=" selected"}l+=">[None]</div>\n";for(h=0;h<o.todo_states.length;h+=1){d=o.todo_states[h];p='<div class="todo-option" todo_id="'+d.pk+'"';p+='style="'+c(d)+'"';if(d.pk===o.heading.fields.todo_state){p+=" selected"}p+=">"+d.fields.abbreviation+"</div>\n";l+=p}i.popover({title:"Todo State",content:l,html:true,container:"#todo-popover"});i.popover("show");$("body").on("click.todo_state",function(q){if(!$(q.target).hasClass("todo-state")){i.popover("destroy")}});j=$(".todo-option").not("[selected]");j.on("click.todostate",function(q){o.$apply(function(){var r=$(q.target).attr("todo_id");if(r===""){o.heading.fields.todo_state=null}else{o.heading.fields.todo_state=parseInt(r,10)}o.heading.update();o.heading.just_modified=true;o.heading.save({auto:true});e(i)})})}m.on("click",function(i){k(m)})}return{link:a,templateUrl:"todo-state-selector",}}]);gtd_module.directive("owListRow",function(){function a(j,c,i){var e,k,h,b,d,f,g;e=parseInt(i.owPk,10);k=j.headings.get({pk:e});f=k.due();if(f===null){g=""}else{if(f<=0){g="danger"}else{if(f>0){g="warning"}}}c.addClass(g)}return{link:a,}});gtd_module.controller("inboxCapture",["$scope","$rootScope",function(b,a){b.capture=function(d){var f,c,g;c={handler_path:"plugins.quickcapture"};g=$(d.target).find("#new_inbox_item");c.subject=g.val();ow_waiting("spinner.inbox");$.ajax("/wolfmail/message/",{type:"POST",data:c,complete:function(){ow_waiting("clear.inbox")},success:function(){g.val("");a.$emit("refresh_messages")},error:function(i,e,h){alert("Failed!");console.log(e);console.log(h)}})}}]);gtd_module.controller("nodeOutline",["$scope","$http","$resource","OldHeading","Heading","$element","$location","$anchorScroll",outlineCtrl]);function outlineCtrl(n,q,h,i,o,l,f,d){var j,e,c,m,g,p,a,b,k,r;r=o.query({parent_id:0,archived:false});n.headings=new HeadingManager(n);n.children=new HeadingManager(n);n.headings.add(r);n.headings.add(r);n.active_scope=0;n.sort_field="title";n.sort_fields=[{key:"title",display:"Title"},{key:"-title",display:"Title (reverse)"},];n.parent_id=l.attr("parent_id");if(n.parent_id===""){n.parent_id=0}else{n.parent_id=parseInt(n.parent_id,10)}n.show_arx=false;n.state="open";n.rank=0;n.update=function(){n.children=n.headings.filter_by({parent:null})};j=h("/gtd/todostate/");n.todo_states=j.query();test_headings=n.todo_states;if(n.parent_id){a=parseInt(l.attr("parent_tree"),10);b=parseInt(l.attr("level"),10);k=o.query({tree_id:a,level__lte:b+1});n.headings.add(k);k.$promise.then(function(){var t,s;t=n.headings.get({pk:n.parent_id});s=function(v){var u;v.toggle("open");v.update();u=v.get_parent();if(u.rank!==0){s(u)}};if(t.fields.archived){n.show_arx=true}s(t);t.editable=true})}m=function(v){var s,u,t;s=$(v.delegateTarget).closest(".heading");t=Number(s.attr("node_id"));u=n.headings.get({pk:t});return u};n.toggle_node=function(v){var s,t,u,w;s=$(v.target);u=m(v);if(s.hasClass("edit-btn")){u.populate_children();u.editable=true}else{if(s.hasClass("todo-state")){console.log("todo-state clicked")}else{if(s.hasClass("archive-btn")){if(u.fields.archived){u.fields.archived=false}else{u.fields.archived=true}u.save()}else{if(s.hasClass("new-btn")){w=new i({id:0,workspace:u.workspace,title:"",parent:u.pk,level:u.fields.level+1,scope:u.fields.scope,});w.editable=true;w.expandable="no";u.children.add(w);n.headings.add(w);u.toggle("open")}else{u.toggle()}}}}};n.show_all=function(t){var s;if(n.show_arx===true){n.show_arx=false}else{n.show_arx=true}if(!n.arx_cached){s=o.query({parent_id:0,archived:true});n.headings.add(s);n.headings.add(s);n.arx_cached=true}};n.add_heading=function(s){var t;console.log(n.children.get({pk:0}));t=new i({id:0,workspace:n,title:"",parent:null,level:0,});t.editable=true;n.headings.add(t);n.children.add(t);console.log(n.children.get({pk:0}))}}gtd_module.controller("nextActionsList",["$sce","$scope","$resource","$location","GtdList","Heading","Upcoming","parent_id","context_id","context_name",listCtrl]);function listCtrl(k,o,q,e,b,j,n,h,a,c){var d,f,m,g;o.list_params={todo_state:2};o.active_context=null;if(a!=="None"){o.active_context=parseInt(a,10);o.context_name=c;o.list_params.context=o.active_context}o.show_list=true;o.update=function(){};f=q("/gtd/todostate/");o.todo_states=f.query();o.parents=new HeadingManager(o);o.parents.add(j.query({level:0}));if(h){o.list_params.parent=parseInt(h,10)}g=new Date();o.scheduled=new HeadingManager(o);o.scheduled.add(j.query({scheduled_date__lte:g.ow_date(),todo_state:8}));console.log(o.scheduled);o.headings=new HeadingManager(o);o.cached_states=[2];o.active_states=[2];o.headings.add(b.query(o.list_params));o.headings.add(n.query());m=q("/gtd/context/");o.contexts=m.query();o.show_arx=true;o.active_scope=0;for(d;d<o.headings.length;d+=1){o.headings[d].parent=o.parents.get({pk:o.headings[d].fields.parent})}o.toggle_todo_state=function(u){var s,v,t,r;v=parseInt($(u.target).attr("ow-state"),10);s=o.active_states.indexOf(v);if(s>-1){o.active_states.splice(s,1)}else{o.active_states.push(v)}if(o.cached_states.indexOf(v)===-1){o.cached_states.push(v);o.list_params.todo_state=v;o.headings.add(b.query(o.list_params))}};function l(){var r,s,t;r="";for(s=0;s<o.active_states.length;s+=1){t=o.todo_states.get({pk:o.active_states[s]});r+=t.fields.abbreviation.toLowerCase();r+="/"}return r}function p(){var i;if(o.active_context){i="context"+o.active_context+"/"}else{i=""}return i}o.change_context=function(i){o.headings=new HeadingManager(o);o.list_params.context=o.active_context;o.list_params.todo_state=o.active_states;o.headings.add(b.query(o.list_params))};o.filter_parent=function(r){if(r===null){delete o.active_root}else{var i=o.parents.get({tree_id:r.fields.tree_id});o.active_root=i}}};"use strict";var Message;Message=function(a){if(a===undefined){a={}}this.fields={};this.set_fields(a)};Message.prototype.set_fields=function(a){$.extend(this.fields,a);this.pk=a.id;this.url="/wolfmail/message/"+this.pk+"/"};Message.prototype.create_node=function(c){var a,d,b;a=this;d=function(){c.list.remove(a)};b={action:"create_node"};$.extend(b,c);delete b.list;delete b.$scope;jQuery.ajax(this.url,{type:"PUT",data:b,success:function(){if(typeof c.$scope!=="undefined"){c.$scope.$apply(d())}else{d()}}})};Message.prototype.delete_msg=function(b){var c,a;a=this;c=function(){b.list.remove(a)};jQuery.ajax(this.url,{type:"DELETE",data:{action:"delete"},success:function(){if(typeof b.$scope!=="undefined"){b.$scope.$apply(c())}else{c()}}})};Message.prototype.archive=function(b){var c,a;a=this;c=function(){b.list.remove(a)};jQuery.ajax(this.url,{type:"PUT",data:{action:"archive"},success:function(){if(typeof b.$scope!=="undefined"){b.$scope.$apply(c())}else{c()}}})};Message.prototype.defer=function(b){var c,a;a=this;c=function(){b.list.remove(a)};jQuery.ajax(this.url,{type:"PUT",data:{action:"defer",target_date:b.target_date},success:function(){if(typeof b.$scope!=="undefined"){b.$scope.$apply(c())}else{c()}}})};"use strict";var MessageFactory,owinbox;gtd_module.factory("MessageAPI",["$resource","$http",MessageFactory]);function MessageFactory(b,c){var a=b("/wolfmail/message/:id",{id:"@id"},{query:{method:"GET",transformResponse:c.defaults.transformResponse.concat([function(f,e){var d,g;for(d=0;d<f.length;d+=1){g=new Message(f[d]);f[d]=g}return f}]),isArray:true},});return a}gtd_module.filter("format_sender",["$sce",function(a){return function(c){var b;if(c.fields.handler_path==="plugins.deferred"){b='<a href="/gtd/project/';b+=c.fields.source_node+"/";b+=c.fields.node_slug+'/">';b+='<span class="dfrd">DFRD</span> Node';b+="</a>";b=a.trustAsHtml(b)}else{if(c.fields.handler_path==="plugins.quickcapture"){b="Quick capture"}else{b=c.fields.sender}}return b}}]);gtd_module.filter("parent_label",function(){return function(c){var b,a;b=" "+c.title;for(a=0;a<c.level;a+=1){b="---"+b}return b}});gtd_module.directive("owMessageRow",function(){function a(e,d,c){var b=$(d);b.find(".glyphicon").tooltip()}return{link:a,}});gtd_module.controller("owInbox",["$scope","$rootScope","$resource","MessageAPI","Heading",owinbox]);function owinbox(c,a,f,d,g){var h,b,e;b=new Date();c.current_date=b;h=b.getFullYear()+"-"+(b.getMonth()+1);h+="-"+b.getDate()+"T23:59:59Z";c.$task_modal=$(".modal.task");c.$delete_modal=$(".modal.delete");c.$defer_modal=$(".modal.defer");e=function(i){c.messages=d.query({in_inbox:true,rcvd_date__lte:h})};a.$on("refresh_messages",e);e();c.projects=g.query({parent_id:0,archived:false});c.new_node={$scope:c,list:c.messages};c.create_task_modal=function(i){c.new_node.title=i.fields.subject;delete c.new_node.tree_id;delete c.new_node.parent;if(i.fields.handler_path==="plugins.deferred"){delete c.new_node.tree_id;delete c.new_node.parent;i.create_node(c.new_node)}else{c.active_msg=i;c.modal_task=true;c.$task_modal.modal()}};c.create_project_modal=function(i){delete c.new_node.tree_id;delete c.new_node.parent;c.new_node.title=i.fields.subject;c.active_msg=i;c.modal_task=false;c.$task_modal.modal()};c.defer_modal=function(j){var i;i=new Date();c.active_msg=j;c.$defer_modal.modal();c.$defer_modal.find(".datepicker").datepicker({format:"yyyy-mm-dd",todayBtn:true,todayHighlight:true,startDate:i,})};c.archive_msg=function(i){i.archive(c.new_node)};c.delete_modal=function(i){c.active_msg=i;c.$delete_modal.modal()};c.change_project=function(i){c.parents=g.query({tree_id:i.tree_id,archived:false});c.parent=i};c.change_parent=function(i){c.new_node.parent=i.id};c.create_node=function(){c.$task_modal.modal("hide");c.active_msg.create_node(c.new_node)};c.defer_msg=function(){c.new_node.target_date=c.$defer_modal.find("#target-date").val();console.log(c.new_node);c.active_msg.defer(c.new_node);c.defer_modal.modal("hide")};c.delete_node=function(){c.$delete_modal.modal("hide");c.active_msg.delete_msg(c.new_node)}};"use strict";$(document).ready(function(){var b,a;a=$(".persona-button");a.bind("click.persona",function(c){navigator.id.request();$(this).attr("data-loading-text","Loading...")});$("#logout").bind("click.persona",function(c){navigator.id.logout()});navigator.id.watch({loggedInUser:persona_user,onlogin:function(c){ow_waiting("spinner");$.ajax({type:"POST",url:"/accounts/login/persona/",data:{assertion:c},success:function(e,d,f){window.location.href=e.next},error:function(f,d,e){navigator.id.logout();alert("Login failure: "+e)}})},onlogout:function(){$.ajax({type:"POST",url:"/accounts/logout/persona/",success:function(d,c,e){location.reload()},error:function(e,c,d){alert("Logout failure: "+d)}})}})});