/*!
 * jQuery Cookie Plugin v1.3
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */
(function(f,b,g){var a=/\+/g;function e(h){return h}function c(h){return decodeURIComponent(h.replace(a," "))}var d=f.cookie=function(p,o,u){if(o!==g){u=f.extend({},d.defaults,u);if(o===null){u.expires=-1}if(typeof u.expires==="number"){var q=u.expires,s=u.expires=new Date();s.setDate(s.getDate()+q)}o=d.json?JSON.stringify(o):String(o);return(b.cookie=[encodeURIComponent(p),"=",d.raw?o:encodeURIComponent(o),u.expires?"; expires="+u.expires.toUTCString():"",u.path?"; path="+u.path:"",u.domain?"; domain="+u.domain:"",u.secure?"; secure":""].join(""))}var h=d.raw?e:c;var r=b.cookie.split("; ");for(var n=0,k=r.length;n<k;n++){var m=r[n].split("=");if(h(m.shift())===p){var j=h(m.join("="));return d.json?JSON.parse(j):j}}return null};d.defaults={};f.removeCookie=function(i,h){if(f.cookie(i)!==null){f.cookie(i,null,h);return true}return false}})(jQuery,document);!function(c){var a=function(e,d){this.element=c(e);this.format=b.parseFormat(d.format||this.element.data("date-format")||"mm/dd/yyyy");this.picker=c(b.template).appendTo("body").on({click:c.proxy(this.click,this),mousedown:c.proxy(this.mousedown,this)});this.isInput=this.element.is("input");this.component=this.element.is(".date")?this.element.find(".add-on"):false;if(this.isInput){this.element.on({focus:c.proxy(this.show,this),blur:c.proxy(this.hide,this),keyup:c.proxy(this.update,this)})}else{if(this.component){this.component.on("click",c.proxy(this.show,this))}else{this.element.on("click",c.proxy(this.show,this))}}this.minViewMode=d.minViewMode||this.element.data("date-minviewmode")||0;if(typeof this.minViewMode==="string"){switch(this.minViewMode){case"months":this.minViewMode=1;break;case"years":this.minViewMode=2;break;default:this.minViewMode=0;break}}this.viewMode=d.viewMode||this.element.data("date-viewmode")||0;if(typeof this.viewMode==="string"){switch(this.viewMode){case"months":this.viewMode=1;break;case"years":this.viewMode=2;break;default:this.viewMode=0;break}}this.startViewMode=this.viewMode;this.weekStart=d.weekStart||this.element.data("date-weekstart")||0;this.weekEnd=this.weekStart===0?6:this.weekStart-1;this.fillDow();this.fillMonths();this.update();this.showMode()};a.prototype={constructor:a,show:function(d){this.picker.show();this.height=this.component?this.component.outerHeight():this.element.outerHeight();this.place();c(window).on("resize",c.proxy(this.place,this));if(d){d.stopPropagation();d.preventDefault()}if(!this.isInput){c(document).on("mousedown",c.proxy(this.hide,this))}this.element.trigger({type:"show",date:this.date})},hide:function(){this.picker.hide();c(window).off("resize",this.place);this.viewMode=this.startViewMode;this.showMode();if(!this.isInput){c(document).off("mousedown",this.hide)}this.set();this.element.trigger({type:"hide",date:this.date})},set:function(){var d=b.formatDate(this.date,this.format);if(!this.isInput){if(this.component){this.element.find("input").prop("value",d)}this.element.data("date",d)}else{this.element.prop("value",d)}},setValue:function(d){if(typeof d==="string"){this.date=b.parseDate(d,this.format)}else{this.date=new Date(d)}this.set();this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0);this.fill()},place:function(){var d=this.component?this.component.offset():this.element.offset();this.picker.css({top:d.top+this.height,left:d.left})},update:function(d){this.date=b.parseDate(typeof d==="string"?d:(this.isInput?this.element.prop("value"):this.element.data("date")),this.format);this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0);this.fill()},fillDow:function(){var d=this.weekStart;var e="<tr>";while(d<this.weekStart+7){e+='<th class="dow">'+b.dates.daysMin[(d++)%7]+"</th>"}e+="</tr>";this.picker.find(".datepicker-days thead").append(e)},fillMonths:function(){var e="";var d=0;while(d<12){e+='<span class="month">'+b.dates.monthsShort[d++]+"</span>"}this.picker.find(".datepicker-months td").append(e)},fill:function(){var o=new Date(this.viewDate),p=o.getFullYear(),n=o.getMonth(),f=this.date.valueOf();this.picker.find(".datepicker-days th:eq(1)").text(b.dates.months[n]+" "+p);var j=new Date(p,n-1,28,0,0,0,0),q=b.getDaysInMonth(j.getFullYear(),j.getMonth());j.setDate(q);j.setDate(q-(j.getDay()-this.weekStart+7)%7);var l=new Date(j);l.setDate(l.getDate()+42);l=l.valueOf();html=[];var h;while(j.valueOf()<l){if(j.getDay()===this.weekStart){html.push("<tr>")}h="";if(j.getMonth()<n){h+=" old"}else{if(j.getMonth()>n){h+=" new"}}if(j.valueOf()===f){h+=" active"}html.push('<td class="day'+h+'">'+j.getDate()+"</td>");if(j.getDay()===this.weekEnd){html.push("</tr>")}j.setDate(j.getDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(html.join(""));var m=this.date.getFullYear();var e=this.picker.find(".datepicker-months").find("th:eq(1)").text(p).end().find("span").removeClass("active");if(m===p){e.eq(this.date.getMonth()).addClass("active")}html="";p=parseInt(p/10,10)*10;var g=this.picker.find(".datepicker-years").find("th:eq(1)").text(p+"-"+(p+9)).end().find("td");p-=1;for(var k=-1;k<11;k++){html+='<span class="year'+(k===-1||k===10?" old":"")+(m===p?" active":"")+'">'+p+"</span>";p+=1}g.html(html)},click:function(i){i.stopPropagation();i.preventDefault();var h=c(i.target).closest("span, td, th");if(h.length===1){switch(h[0].nodeName.toLowerCase()){case"th":switch(h[0].className){case"switch":this.showMode(1);break;case"prev":case"next":this.viewDate["set"+b.modes[this.viewMode].navFnc].call(this.viewDate,this.viewDate["get"+b.modes[this.viewMode].navFnc].call(this.viewDate)+b.modes[this.viewMode].navStep*(h[0].className==="prev"?-1:1));this.fill();this.set();break}break;case"span":if(h.is(".month")){var g=h.parent().find("span").index(h);this.viewDate.setMonth(g)}else{var f=parseInt(h.text(),10)||0;this.viewDate.setFullYear(f)}if(this.viewMode!==0){this.date=new Date(this.viewDate);this.element.trigger({type:"changeDate",date:this.date,viewMode:b.modes[this.viewMode].clsName})}this.showMode(-1);this.fill();this.set();break;case"td":if(h.is(".day")){var d=parseInt(h.text(),10)||1;var g=this.viewDate.getMonth();if(h.is(".old")){g-=1}else{if(h.is(".new")){g+=1}}var f=this.viewDate.getFullYear();this.date=new Date(f,g,d,0,0,0,0);this.viewDate=new Date(f,g,Math.min(28,d),0,0,0,0);this.fill();this.set();this.element.trigger({type:"changeDate",date:this.date,viewMode:b.modes[this.viewMode].clsName})}break}}},mousedown:function(d){d.stopPropagation();d.preventDefault()},showMode:function(d){if(d){this.viewMode=Math.max(this.minViewMode,Math.min(2,this.viewMode+d))}this.picker.find(">div").hide().filter(".datepicker-"+b.modes[this.viewMode].clsName).show()}};c.fn.datepicker=function(d,e){return this.each(function(){var h=c(this),g=h.data("datepicker"),f=typeof d==="object"&&d;if(!g){h.data("datepicker",(g=new a(this,c.extend({},c.fn.datepicker.defaults,f))))}if(typeof d==="string"){g[d](e)}})};c.fn.datepicker.defaults={};c.fn.datepicker.Constructor=a;var b={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],dates:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},isLeapYear:function(d){return(((d%4===0)&&(d%100!==0))||(d%400===0))},getDaysInMonth:function(d,e){return[31,(b.isLeapYear(d)?29:28),31,30,31,30,31,31,30,31,30,31][e]},parseFormat:function(f){var e=f.match(/[.\/\-\s].*?/),d=f.split(/\W+/);if(!e||!d||d.length===0){throw new Error("Invalid date format.")}return{separator:e,parts:d}},parseDate:function(d,h){var g=d.split(h.separator),d=new Date(),j;d.setHours(0);d.setMinutes(0);d.setSeconds(0);d.setMilliseconds(0);if(g.length===h.parts.length){for(var f=0,e=h.parts.length;f<e;f++){j=parseInt(g[f],10)||1;switch(h.parts[f]){case"dd":case"d":d.setDate(j);break;case"mm":case"m":d.setMonth(j-1);break;case"yy":d.setFullYear(2000+j);break;case"yyyy":d.setFullYear(j);break}}}return d},formatDate:function(d,g){var h={d:d.getDate(),m:d.getMonth()+1,yy:d.getFullYear().toString().substring(2),yyyy:d.getFullYear()};h.dd=(h.d<10?"0":"")+h.d;h.mm=(h.m<10?"0":"")+h.m;var d=[];for(var f=0,e=g.parts.length;f<e;f++){d.push(h[g.parts[f]])}return d.join(g.separator)},headTemplate:'<thead><tr><th class="prev">&lsaquo;</th><th colspan="5" class="switch"></th><th class="next">&rsaquo;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>'};b.template='<div class="datepicker dropdown-menu"><div class="datepicker-days"><table class=" table-condensed">'+b.headTemplate+'<tbody></tbody></table></div><div class="datepicker-months"><table class="table-condensed">'+b.headTemplate+b.contTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+b.headTemplate+b.contTemplate+"</table></div></div>"}(window.jQuery);!function(b){var a=function(d,c){this.$element=b(d);this.options=b.extend({},b.fn.timepicker.defaults,c,this.$element.data());this.minuteStep=this.options.minuteStep||this.minuteStep;this.secondStep=this.options.secondStep||this.secondStep;this.showMeridian=this.options.showMeridian||this.showMeridian;this.showSeconds=this.options.showSeconds||this.showSeconds;this.showInputs=this.options.showInputs||this.showInputs;this.disableFocus=this.options.disableFocus||this.disableFocus;this.template=this.options.template||this.template;this.modalBackdrop=this.options.modalBackdrop||this.modalBackdrop;this.defaultTime=this.options.defaultTime||this.defaultTime;this.open=false;this.init()};a.prototype={constructor:a,init:function(){if(this.$element.parent().hasClass("input-append")){this.$element.parent(".input-append").find(".add-on").on("click",b.proxy(this.showWidget,this));this.$element.on({focus:b.proxy(this.highlightUnit,this),click:b.proxy(this.highlightUnit,this),keypress:b.proxy(this.elementKeypress,this),blur:b.proxy(this.blurElement,this)})}else{if(this.template){this.$element.on({focus:b.proxy(this.showWidget,this),click:b.proxy(this.showWidget,this),blur:b.proxy(this.blurElement,this)})}else{this.$element.on({focus:b.proxy(this.highlightUnit,this),click:b.proxy(this.highlightUnit,this),keypress:b.proxy(this.elementKeypress,this),blur:b.proxy(this.blurElement,this)})}}this.$widget=b(this.getTemplate()).appendTo("body");this.$widget.on("click",b.proxy(this.widgetClick,this));if(this.showInputs){this.$widget.find("input").on({click:function(){this.select()},keypress:b.proxy(this.widgetKeypress,this),change:b.proxy(this.updateFromWidgetInputs,this)})}this.setDefaultTime(this.defaultTime)},showWidget:function(c){c.stopPropagation();c.preventDefault();if(this.open){return}this.$element.trigger("show");if(this.disableFocus){this.$element.blur()}var d=b.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});this.updateFromElementVal();b("html").trigger("click.timepicker.data-api").one("click.timepicker.data-api",b.proxy(this.hideWidget,this));if(this.template==="modal"){this.$widget.modal("show").on("hidden",b.proxy(this.hideWidget,this))}else{this.$widget.css({top:d.top+d.height,left:d.left});if(!this.open){this.$widget.addClass("open")}}this.open=true;this.$element.trigger("shown")},hideWidget:function(){this.$element.trigger("hide");if(this.template==="modal"){this.$widget.modal("hide")}else{this.$widget.removeClass("open")}this.open=false;this.$element.trigger("hidden")},widgetClick:function(d){d.stopPropagation();d.preventDefault();var c=b(d.target).closest("a").data("action");if(c){this[c]();this.update()}},widgetKeypress:function(d){var c=b(d.target).closest("input").attr("name");switch(d.keyCode){case 9:if(this.showMeridian){if(c=="meridian"){this.hideWidget()}}else{if(this.showSeconds){if(c=="second"){this.hideWidget()}}else{if(c=="minute"){this.hideWidget()}}}break;case 27:this.hideWidget();break;case 38:switch(c){case"hour":this.incrementHour();break;case"minute":this.incrementMinute();break;case"second":this.incrementSecond();break;case"meridian":this.toggleMeridian();break}this.update();break;case 40:switch(c){case"hour":this.decrementHour();break;case"minute":this.decrementMinute();break;case"second":this.decrementSecond();break;case"meridian":this.toggleMeridian();break}this.update();break}},elementKeypress:function(d){var c=this.$element.get(0);switch(d.keyCode){case 0:break;case 9:this.updateFromElementVal();if(this.showMeridian){if(this.highlightedUnit!="meridian"){d.preventDefault();this.highlightNextUnit()}}else{if(this.showSeconds){if(this.highlightedUnit!="second"){d.preventDefault();this.highlightNextUnit()}}else{if(this.highlightedUnit!="minute"){d.preventDefault();this.highlightNextUnit()}}}break;case 27:this.updateFromElementVal();break;case 37:this.updateFromElementVal();this.highlightPrevUnit();break;case 38:switch(this.highlightedUnit){case"hour":this.incrementHour();break;case"minute":this.incrementMinute();break;case"second":this.incrementSecond();break;case"meridian":this.toggleMeridian();break}this.updateElement();break;case 39:this.updateFromElementVal();this.highlightNextUnit();break;case 40:switch(this.highlightedUnit){case"hour":this.decrementHour();break;case"minute":this.decrementMinute();break;case"second":this.decrementSecond();break;case"meridian":this.toggleMeridian();break}this.updateElement();break}if(d.keyCode!==0&&d.keyCode!==8&&d.keyCode!==9&&d.keyCode!==46){d.preventDefault()}},setValues:function(e){if(this.showMeridian){var c=e.split(" ");var d=c[0].split(":");this.meridian=c[1]}else{var d=e.split(":")}this.hour=parseInt(d[0],10);this.minute=parseInt(d[1],10);this.second=parseInt(d[2],10);if(isNaN(this.hour)){this.hour=0}if(isNaN(this.minute)){this.minute=0}if(this.showMeridian){if(this.hour>12){this.hour=12}else{if(this.hour<1){this.hour=1}}if(this.meridian=="am"||this.meridian=="a"){this.meridian="AM"}else{if(this.meridian=="pm"||this.meridian=="p"){this.meridian="PM"}}if(this.meridian!="AM"&&this.meridian!="PM"){this.meridian="AM"}}else{if(this.hour>=24){this.hour=23}else{if(this.hour<0){this.hour=0}}}if(this.minute<0){this.minute=0}else{if(this.minute>=60){this.minute=59}}if(this.showSeconds){if(isNaN(this.second)){this.second=0}else{if(this.second<0){this.second=0}else{if(this.second>=60){this.second=59}}}}if(this.$element.val()!=""){this.updateElement()}this.updateWidget()},setMeridian:function(c){if(c=="a"||c=="am"||c=="AM"){this.meridian="AM"}else{if(c=="p"||c=="pm"||c=="PM"){this.meridian="PM"}else{this.updateWidget()}}this.updateElement()},setDefaultTime:function(e){if(e){if(e==="current"){var c=new Date();var d=c.getHours();var g=Math.floor(c.getMinutes()/this.minuteStep)*this.minuteStep;var h=Math.floor(c.getSeconds()/this.secondStep)*this.secondStep;var f="AM";if(this.showMeridian){if(d===0){d=12}else{if(d>=12){if(d>12){d=d-12}f="PM"}else{f="AM"}}}this.hour=d;this.minute=g;this.second=h;this.meridian=f}else{if(e==="value"){this.setValues(this.$element.val())}else{this.setValues(e)}}if(this.$element.val()!=""){this.updateElement()}this.updateWidget()}else{this.hour=0;this.minute=0;this.second=0}},formatTime:function(c,f,d,e){c=c<10?"0"+c:c;f=f<10?"0"+f:f;d=d<10?"0"+d:d;return c+":"+f+(this.showSeconds?":"+d:"")+(this.showMeridian?" "+e:"")},getTime:function(){return this.formatTime(this.hour,this.minute,this.second,this.meridian)},setTime:function(c){this.setValues(c);this.update()},update:function(){this.updateElement();this.updateWidget()},blurElement:function(){this.highlightedUnit=undefined;this.updateFromElementVal()},updateElement:function(){var c=this.getTime();this.$element.val(c).change();switch(this.highlightedUnit){case"hour":this.highlightHour();break;case"minute":this.highlightMinute();break;case"second":this.highlightSecond();break;case"meridian":this.highlightMeridian();break}},updateWidget:function(){if(this.showInputs){this.$widget.find("input.bootstrap-timepicker-hour").val(this.hour<10?"0"+this.hour:this.hour);this.$widget.find("input.bootstrap-timepicker-minute").val(this.minute<10?"0"+this.minute:this.minute);if(this.showSeconds){this.$widget.find("input.bootstrap-timepicker-second").val(this.second<10?"0"+this.second:this.second)}if(this.showMeridian){this.$widget.find("input.bootstrap-timepicker-meridian").val(this.meridian)}}else{this.$widget.find("span.bootstrap-timepicker-hour").text(this.hour);this.$widget.find("span.bootstrap-timepicker-minute").text(this.minute<10?"0"+this.minute:this.minute);if(this.showSeconds){this.$widget.find("span.bootstrap-timepicker-second").text(this.second<10?"0"+this.second:this.second)}if(this.showMeridian){this.$widget.find("span.bootstrap-timepicker-meridian").text(this.meridian)}}},updateFromElementVal:function(d){var c=this.$element.val();if(c){this.setValues(c);this.updateWidget()}},updateFromWidgetInputs:function(){var c=b("input.bootstrap-timepicker-hour",this.$widget).val()+":"+b("input.bootstrap-timepicker-minute",this.$widget).val()+(this.showSeconds?":"+b("input.bootstrap-timepicker-second",this.$widget).val():"")+(this.showMeridian?" "+b("input.bootstrap-timepicker-meridian",this.$widget).val():"");this.setValues(c)},getCursorPosition:function(){var d=this.$element.get(0);if("selectionStart" in d){return d.selectionStart}else{if(document.selection){d.focus();var e=document.selection.createRange();var c=document.selection.createRange().text.length;e.moveStart("character",-d.value.length);return e.text.length-c}}},highlightUnit:function(){var c=this.$element.get(0);this.position=this.getCursorPosition();if(this.position>=0&&this.position<=2){this.highlightHour()}else{if(this.position>=3&&this.position<=5){this.highlightMinute()}else{if(this.position>=6&&this.position<=8){if(this.showSeconds){this.highlightSecond()}else{this.highlightMeridian()}}else{if(this.position>=9&&this.position<=11){this.highlightMeridian()}}}}},highlightNextUnit:function(){switch(this.highlightedUnit){case"hour":this.highlightMinute();break;case"minute":if(this.showSeconds){this.highlightSecond()}else{this.highlightMeridian()}break;case"second":this.highlightMeridian();break;case"meridian":this.highlightHour();break}},highlightPrevUnit:function(){switch(this.highlightedUnit){case"hour":this.highlightMeridian();break;case"minute":this.highlightHour();break;case"second":this.highlightMinute();break;case"meridian":if(this.showSeconds){this.highlightSecond()}else{this.highlightMinute()}break}},highlightHour:function(){this.highlightedUnit="hour";this.$element.get(0).setSelectionRange(0,2)},highlightMinute:function(){this.highlightedUnit="minute";this.$element.get(0).setSelectionRange(3,5)},highlightSecond:function(){this.highlightedUnit="second";this.$element.get(0).setSelectionRange(6,8)},highlightMeridian:function(){this.highlightedUnit="meridian";if(this.showSeconds){this.$element.get(0).setSelectionRange(9,11)}else{this.$element.get(0).setSelectionRange(6,8)}},incrementHour:function(){if(this.showMeridian){if(this.hour===11){this.toggleMeridian()}else{if(this.hour===12){return this.hour=1}}}if(this.hour===23){return this.hour=0}this.hour=this.hour+1},decrementHour:function(){if(this.showMeridian){if(this.hour===1){return this.hour=12}else{if(this.hour===12){this.toggleMeridian()}}}if(this.hour===0){return this.hour=23}this.hour=this.hour-1},incrementMinute:function(){var c=this.minute+this.minuteStep-(this.minute%this.minuteStep);if(c>59){this.incrementHour();this.minute=c-60}else{this.minute=c}},decrementMinute:function(){var c=this.minute-this.minuteStep;if(c<0){this.decrementHour();this.minute=c+60}else{this.minute=c}},incrementSecond:function(){var c=this.second+this.secondStep-(this.second%this.secondStep);if(c>59){this.incrementMinute();this.second=c-60}else{this.second=c}},decrementSecond:function(){var c=this.second-this.secondStep;if(c<0){this.decrementMinute();this.second=c+60}else{this.second=c}},toggleMeridian:function(){this.meridian=this.meridian==="AM"?"PM":"AM";this.update()},getTemplate:function(){if(this.options.templates[this.options.template]){return this.options.templates[this.options.template]}if(this.showInputs){var g='<input type="text" name="hour" class="bootstrap-timepicker-hour" maxlength="2"/>';var d='<input type="text" name="minute" class="bootstrap-timepicker-minute" maxlength="2"/>';var c='<input type="text" name="second" class="bootstrap-timepicker-second" maxlength="2"/>';var f='<input type="text" name="meridian" class="bootstrap-timepicker-meridian" maxlength="2"/>'}else{var g='<span class="bootstrap-timepicker-hour"></span>';var d='<span class="bootstrap-timepicker-minute"></span>';var c='<span class="bootstrap-timepicker-second"></span>';var f='<span class="bootstrap-timepicker-meridian"></span>'}var h='<table class="'+(this.showSeconds?"show-seconds":"")+" "+(this.showMeridian?"show-meridian":"")+'"><tr><td><a href="#" data-action="incrementHour"><i class="icon-chevron-up"></i></a></td><td class="separator">&nbsp;</td><td><a href="#" data-action="incrementMinute"><i class="icon-chevron-up"></i></a></td>'+(this.showSeconds?'<td class="separator">&nbsp;</td><td><a href="#" data-action="incrementSecond"><i class="icon-chevron-up"></i></a></td>':"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td class="meridian-column"><a href="#" data-action="toggleMeridian"><i class="icon-chevron-up"></i></a></td>':"")+"</tr><tr><td>"+g+'</td> <td class="separator">:</td><td>'+d+"</td> "+(this.showSeconds?'<td class="separator">:</td><td>'+c+"</td>":"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td>'+f+"</td>":"")+'</tr><tr><td><a href="#" data-action="decrementHour"><i class="icon-chevron-down"></i></a></td><td class="separator"></td><td><a href="#" data-action="decrementMinute"><i class="icon-chevron-down"></i></a></td>'+(this.showSeconds?'<td class="separator">&nbsp;</td><td><a href="#" data-action="decrementSecond"><i class="icon-chevron-down"></i></a></td>':"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td><a href="#" data-action="toggleMeridian"><i class="icon-chevron-down"></i></a></td>':"")+"</tr></table>";var e;switch(this.options.template){case"modal":e='<div class="bootstrap-timepicker modal hide fade in" style="top: 30%; margin-top: 0; width: 200px; margin-left: -100px;" data-backdrop="'+(this.modalBackdrop?"true":"false")+'"><div class="modal-header"><a href="#" class="close" data-dismiss="modal">×</a><h3>Pick a Time</h3></div><div class="modal-content">'+h+'</div><div class="modal-footer"><a href="#" class="btn btn-primary" data-dismiss="modal">Ok</a></div></div>';break;case"dropdown":e='<div class="bootstrap-timepicker dropdown-menu">'+h+"</div>";break}return e}};b.fn.timepicker=function(c){return this.each(function(){var f=b(this),e=f.data("timepicker"),d=typeof c=="object"&&c;if(!e){f.data("timepicker",(e=new a(this,d)))}if(typeof c=="string"){e[c]()}})};b.fn.timepicker.defaults={minuteStep:15,secondStep:15,disableFocus:false,defaultTime:"current",showSeconds:false,showInputs:true,showMeridian:true,template:"dropdown",modalBackdrop:false,templates:{}};b.fn.timepicker.Constructor=a}(window.jQuery);"use strict";var attach_pickers,validate_node,GtdHeading;validate_node=function(i){var b,j,e,a,h,f,c,g;b=/\S/;j=/\D/;e=true;a=function(d){d.find(".error").remove();d.find(".invalid").removeClass("invalid")};i.each(function(){var d=$(this);a(d);$(this).find("[data-validate]").each(function(){var k=$(this).attr("data-validate");if(k==="required"){if(!b.test($(this).val())){e=false;$(this).focus();$(this).addClass("invalid");$(this).after('<span class="error"><br />This field is required</span>')}}else{if(k==="date"){h=$(this).val();if(b.test(h)){f=h.split("-");c=new Date(f[0],f[1]-1,f[2]);if(c.getFullYear()!==Number(f[0])||c.getMonth()+1!==Number(f[1])||c.getDate()!==Number(f[2])){$(this).addClass("invalid");$(this).after('<span class="error"><br />Please enter a valid date in the form YYYY-MM-DD</span>');e=false;$(this).focus()}}}else{if(k==="time"){h=$(this).val();if(b.test(h)){f=h.split(":");g=new Date(0,0,0,f[0],f[1]);if(g.getHours()!==Number(f[0])||g.getMinutes()!==Number(f[1])){$(this).addClass("invalid");$(this).after('<span class="error"><br />Please enter a valid 24-hour time in the form HH:MM</span>');e=false;$(this).focus()}}}else{if(k==="int"){h=$(this).val();if(b.test(h)&&j.test(h)){e=false;$(this).focus();$(this).addClass("invalid");$(this).after('<span class="error"><br />Please enter an integer</span>')}}}}}});$(this).find("[data-requires]").each(function(){var o,l,m,k,n;o=$(this);if(o.prop("checked")){l=$(this).attr("data-requires").split(",");for(m=0;m<l.length;m+=1){k=d.find(l[m]);n=k.val();if(!b.test(n)){e=false;$(this).focus();k.addClass("invalid");k.parent().append('<span class="error"><br />Field required by '+o.attr("id")+"</span>")}}}})});return e};function repeating_toggle(b,a){if(a.find(b).prop("checked")){a.find("#id_repeating_number").prop("disabled",false);a.find("#id_repeating_unit").prop("disabled",false);a.find("#id_repeats_from_completion").prop("disabled",false)}else{a.find("#id_repeating_number").prop("disabled",true);a.find("#id_repeating_unit").prop("disabled",true);a.find("#id_repeats_from_completion").prop("disabled",true)}}attach_pickers=function(b){var c,a,d;b.find("#id_repeats").bind("change.repeat",function(){repeating_toggle("#id_repeats",b)});repeating_toggle("#id_repeats",b);if($.fn.datepicker){b.find("input.datepicker").each(function(e){$(this).wrap('<div class="date datepicker input-append" data-date></div>');$(this).after('<span class="add-on">\n<i class="icon-calendar"></i>\n</span>');c=$(this).next("span.add-on").outerWidth();a=$(this).width()-c;$(this).width(a);$(this).removeClass("datepicker")});b.find(".datepicker").each(function(){$(this).datepicker({format:"yyyy-mm-dd"}).on("changeDate",function(){$(this).datepicker("hide")})});b.find("input.timepicker").each(function(e){$(this).wrap('<div class="bootstrap-timepicker-component input-append" data-date></div>');$(this).after('<span class="add-on">\n<i class="icon-time"></i>\n</span>');c=$(this).next("span.add-on").outerWidth();a=$(this).width()-c;$(this).width(a)});d=function(h){var g,e,f;g="#"+h;e="#id_"+$("#"+h).attr("toggles");f=e+" ~ span.add-on";if(b.find(g).prop("checked")){b.find(e).prop("disabled",false);b.find(f).removeClass("disabled")}else{b.find(e).prop("disabled",true);b.find(f).addClass("disabled")}};b.find("#id_scheduled_time_specific").click(function(){d($(this).attr("id"))});b.find("#id_deadline_time_specific").click(function(){d($(this).attr("id"))});d("id_scheduled_time_specific");d("id_deadline_time_specific");b.find("#id_scheduled_time").timepicker({defaultTime:"value",showMeridian:false});b.find("#id_deadline_time").timepicker({defaultTime:"value",showMeridian:false})}};$(document).ready(function(){attach_pickers($("body"));function a(c){var g,f,e,d;g=null;if(document.cookie&&document.cookie!==""){f=document.cookie.split(";");for(e=0;e<f.length;e+=1){d=jQuery.trim(f[e]);if(d.substring(0,c.length+1)===(c+"=")){g=decodeURIComponent(d.substring(c.length+1));break}}}return g}var b=a("csrftoken");$.ajaxSetup({beforeSend:function(c){c.setRequestHeader("X-CSRFToken",b)}})});(function(b){var a={init:function(c){return this.each(function(){var m,e,l,f,h,o,q,d,g,p,j,r,k,n;e=b(this);l=e.data("todoState");if(!l){e.find("a").contents().unwrap();f=e.attr("todo_id");h=b.extend({states:[{pk:0,display:"[None]"},],todo_id:f,node_id:0,click:function(){},parent_elem:e.parent()},c);o=function(u){var t,s;t={pk:-1,display:"",full:""};for(s=0;s<h.states.length;s+=1){if(h.states[s].pk===u){t=h.states[s]}}return t};h.get_todo_id=function(){var i;if(this.heading){i=this.heading.todo_id}else{i=this.todo_id}return Number(i)};q=o(f);d=function(){j.hide();e.unbind(".autohide")};g=function(){j.show();b("body").one("click.autohide",function(){d()});j.bind("click",function(i){i.stopPropagation()});e.bind("click.autohide",function(){d()})};e.tooltip({delay:{show:1000,hide:100},title:"click to change",placement:"right"});e.attr("data-original-title",q.full);p="";p+='<div class="popover right todostate">\n';p+='  <div class="arrow"></div>\n';p+='  <div class="popover-title">Todo State</div>\n';p+='  <div class="popover-inner">\n';p+="  </div>\n";p+="</div>\n";e.after(p);j=e.next(".popover");r=j.children(".popover-inner");j.hide();j.css("position","absolute");for(m=0;m<h.states.length;m+=1){k="";k+='<div class="todo-option"';k+=' todo_id="';k+=h.states[m].pk;k+='"';if(h.states[m].pk===h.get_todo_id()){k+=" selected"}k+=">";k+=h.states[m].display;k+="</div>\n";r.append(k)}e.bind("click",function(v){var s,u,i,t,w;v.stopPropagation();b(".popover.todostate").hide();e=b(this);e.tooltip("hide");s=e.position().left+e.width();j.css("left",s+"px");u=e.position().top;i=e.height();t=u+(i/2);w=t-(j.height()/2);j.css("top",w+"px");g()});n=r.children(".todo-option");n.mouseenter(function(){if(!b(this).attr("selected")){b(this).addClass("ow-hover")}});n.mouseleave(function(){b(this).removeClass("ow-hover")});n.bind("click",function(){var i,t,v,s,u;i=Number(b(this).attr("todo_id"));t=b(this).parent().parent();v=t.parent().parent().data("nodeOutline");s="/gtd/node/"+h.node_id+"/edit/";u={format:"json",todo_id:i,};if(i!==h.get_todo_id()){b.post(s,u,function(x){var A,w,y,z;x=b.parseJSON(x);if(x.status==="success"){if(h.heading){A=h.heading;w=A.todo_id;A.todo_id=x.todo_id}else{w=e.attr("todo_id");e.attr("todo_id",x.todo_id);f=x.todo_id;h.todo_id=x.todo_id}y=o(x.todo_id);e.html(y.display);e.attr("data-original-title",y.full);n.removeAttr("selected");z='.todo-option[todo_id="';z+=x.todo_id+'"]';r.children(z).attr("selected","");h.click(x);e.mouseenter();e.mouseleave()}});d()}});e.data("todoState",h)}})},update:function(c){this.each(function(){var i,h,g,e,d,f;i=b(this);h=i.data("todoState");g=i.next(".popover");if(typeof c.todo_id!=="undefined"){h.todo_id=c.todo_id;i.attr("todo_id",c.todo_id);e=".todo-option";d=e+'[todo_id="'+c.todo_id+'"]';g.find(e).removeAttr("selected");g.find(d).attr("selected","selected");f=h.states.filter(function(j){return j.pk===Number(c.todo_id)})[0];i.html(f.display);if(h.todo_id>0){i.show()}else{i.hide()}}i.data("todoState",h)})}};b.fn.todoState=function(d){var c;if(a[d]){c=a[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){c=a.init.apply(this,arguments)}else{b.error("Method "+d+" does not exist on jQuery.todoState")}}return c}}(jQuery));(function(a){a.fn.alohaText=function(b){var c=this;if(typeof b!=="object"){b={}}b.$element=c;if(typeof b.$parent==="undefined"){b.$parent=b.$element.parent()}Aloha.ready(function(){var d=Aloha.jQuery(c);d.aloha()});c.data("alohaText",b);return this};a("document").ready(function(){Aloha.ready(function(){console.log("# Todo: Switch Aloha editor to PubSub");Aloha.bind("aloha-editable-deactivated",function(g,j){var d,h,k,f,b,c,i;d=j.editable;if(d.snapshotContent!==d.obj.html()){h=a(d.obj.context);k=h.data("alohaText");if(k){f=k.$parent;b="/gtd/node/"+f.attr("node_id")+"/edit/";c=h.html();if(c==="<br>"){c=""}i={format:"json",node_id:f.attr("node_id"),text:c};a.post(b,i,function(l){var e;l=a.parseJSON(l);if(k.heading){e=k.heading.$buttons.find("#edit-modal");k.heading.text=l.text}else{e=f.data("nodeOutline").$buttons.find("#edit-modal")}if(e.length>0){e.each(function(){var n,m;n=a(this).find("#id_text");m=n.siblings("#id_text-aloha");n.html(l.text);m.html(l.text)})}})}}})})})}(jQuery));(function(a){a.fn.nodeList=function(b){this.find(".list-node").each(function(){var e,d,c;e=a(this).attr("node_id");d=a(this).find(".todo-state");c=d.attr("todo_id");if(c===""){d.attr("todo_id",0);d.html('<span class="todo-none">[None]</span>\n')}d.todoState({states:b.states,node_id:e})});return this}}(jQuery));GtdHeading=function(a){if(!a){a={}}GtdHeading.ICON="icon-chevron-right";this.pk=0;this.populated=false;this.text="";this.todo_id=0;this.archived=false;this.level=1;this.scope=[];this.related_projects=[];var b=$("body");b.append('<i id="7783452" class="'+GtdHeading.ICON+'"></i>');this.icon_width=Number(b.find("#7783452").css("width").slice(0,-2));$("#7783452").remove();this.set_fields(a)};GtdHeading.prototype.set_fields=function(a){var b;if(typeof a.title_html==="undefined"){a.title_html=a.title}if(typeof a.pk!=="undefined"){a.pk=Number(a.pk)}if(typeof a.is_leaf_node!=="undefined"){a.has_children=!a.is_leaf_node;delete a.is_leaf_node}if(typeof a.todo_state!=="undefined"){a.todo_id=a.todo_state;delete a.todo_state}if(typeof a.previous_sibling_id!=="undefined"){a.previous_sibling=a.previous_sibling_id;delete a.previous_sibling_id}for(b in a){if(a.hasOwnProperty(b)){this[b]=a[b]}}return true};GtdHeading.prototype.get_todo_state=function(){var d,b,c,a;d=null;if(typeof this.workspace!=="undefined"){for(b=0;b<this.workspace.todo_states.length;b+=1){c=this.workspace.todo_states[b];if(c.pk===Number(this.todo_id)){d=c}}}if(d){a=d}else{a={pk:this.todo_id}}return a};GtdHeading.prototype.set_selectors=function(){if(this.level>0){var a=".heading";a+='[node_id="'+this.pk+'"]';this.$element=this.workspace.$children.find(a);this.$hoverable=this.$element.children(".ow-hoverable");this.$details=this.$element.children(".details");this.$children=this.$details.children(".children");this.$loading=this.$details.children(".loading");this.$clickable=this.$hoverable.children(".clickable");this.$todo_state=this.$hoverable.children(".todo-state");this.$icon=this.$hoverable.children("i");this.$text=this.$details.children(".ow-text");this.$buttons=this.$hoverable.children(".ow-buttons");this.$title=this.$hoverable.children(".ow-title")}};GtdHeading.prototype.as_html=function(){var a="";a+='<div class="heading" node_id="'+this.pk+'">\n';a+='  <div class="ow-hoverable">\n';a+='    <i class="twisty clickable '+GtdHeading.ICON+'"></i>\n';a+='    <span class="todo-state update" data-field="todo_abbr"></span>\n';a+='    <div class="clickable ow-title"></div>\n';a+='    <div class="ow-buttons">\n';a+='      <i class="icon-pencil edit-btn" title="Edit"></i>\n';a+='      <i class="icon-arrow-right detail-btn" title="Detail view"></i>\n';a+='      <i class="icon-folder-close archive-btn" title="Archive / Unarchive"></i>\n';a+='      <i class="icon-plus new-btn" title="New subheading"></i>\n';a+="    </div>\n";a+="  </div>\n";a+='  <div class="details">\n';a+='    <div class="ow-text"></div>\n';a+='    <div class="children">\n';a+="    </div>\n";if(this.has_children){a+='    <div class="loading">\n';a+="      <em>Loading...</em>\n";a+="    </div>\n"}a+="  </div>\n</div>\n";return a};GtdHeading.prototype.create_div=function(b){var k,d,e,l,f,i,c,h,j,g,a;k=this;if(typeof this.$element==="undefined"){d=true}else{this.set_selectors();if(this.$element.length<1){d=true}else{if(this.$element.length>1){this.$element.each(function(){$(this).remove()});d=true}else{d=false}}}if(d&&(this.level>0)){e=this.pk;if(b){l=function(m){b.append(m)}}else{f=this.get_previous_sibling();i=this.pk;if(f){f.create_div();l=function(m){f.$element.after(m)}}else{if(this.workspace.get_heading(this.parent_id)){c=this.workspace;h=this.parent_id;b=c.get_heading(h).$children;l=function(m){b.prepend(m)}}else{return 1}}}l(this.as_html());this.set_selectors();this.state="closed";this.$details.hide();this.$buttons.children("i").tooltip({delay:{show:1000,hide:100}});j=this.workspace.COLORS;g=this.level%j.length;this.color=j[g-1];this.$clickable.css("color",this.color);this.set_indent(this.$children,1);this.set_indent(this.$loading,1);this.set_indent(this.$text,1);k=this;this.$clickable.click(function(){k.toggle()});this.$buttons.find(".icon-arrow-right").click(function(){window.location="/gtd/node/"+e+"/"});this.$buttons.find(".edit-btn").click(function(){var o,m,n;o=$(this);m=o.parent().parent();n=m.parent();m.unbind(".autohide");o.nodeEdit({$modal:k.workspace.$edit_modal,heading:k,show:true,target:m,node_id:e,changed:function(q){m.find(".todo-state").todoState("update",{todo_id:q.todo_state});k.text=q.text;k.archived=q.archived;k.title=q.title;var p=k.get_parent();if(p){p.redraw()}else{k.redraw()}},})});this.$buttons.find(".new-btn").click(function(){var m;m=$(this);m.parent().parent().unbind(".autohide");m.nodeEdit({show:true,parent:k,$modal:k.workspace.$edit_modal,changed:function(o){var p,n;o.workspace=k.workspace;p=new GtdHeading(o);k.workspace.headings.add(p);n=p.get_parent();n.has_children=true;n.redraw();n.open()},})});this.$buttons.find(".archive-btn").click(function(){var m,n={};m="/gtd/node/"+k.pk+"/edit/";n.format="json";if(k.archived){n.archived=false}else{n.archived=true}$.post(m,n,function(o){o=$.parseJSON(o);if(o.status==="success"){k.archived=o.archived;k.redraw()}})});a=this.todo_states;return 1}};GtdHeading.prototype.get_previous_sibling=function(){return this.workspace.headings.get({pk:Number(this.previous_sibling)})};GtdHeading.prototype.get_parent=function(){return this.workspace.headings.get({pk:this.parent_id})};GtdHeading.prototype.get_children=function(){return this.workspace.headings.filter({parent_id:this.pk})};GtdHeading.prototype.is_expandable=function(){var b,c,a;b=false;if(this.level===0){b=true}if(this.text){b=true}else{if(this.workspace.show_all){if(this.workspace.scope){b=this.get_children().filter({scope:this.workspace.scope}).length}else{b=this.has_children}}else{c=this.get_children();if(this.workspace.scope){c=c.filter({scope:this.workspace.scope})}if(c.filter({archived:false}).length){b=true}else{if(this.populated===false&&this.has_children){b=true}}}}if(b){a=true}else{a=false}return a};GtdHeading.prototype.has_scope=function(b){var a;if(b===0){a=true}else{if((b===-1)&&(this.scope.length===0)){a=true}else{if(jQuery.inArray(b,this.scope)>-1){a=true}else{a=false}}}return a};GtdHeading.prototype.redraw=function(){var a,f,c,b,e,d;this.set_selectors();this.create_div();if(this.level>0){this.$element.addClass("hidden")}if(this.text){this.$element.addClass("expandable");this.$element.removeClass("lazy-expandable");this.$element.removeClass("arch-expandable")}else{if(this.workspace.show_all&&this.has_children){this.$element.addClass("expandable");this.$element.removeClass("lazy-expandable");this.$element.removeClass("arch-expandable")}else{if(this.populated&&this.has_children){if(this.is_expandable()){this.$element.addClass("expandable");this.$element.removeClass("lazy-expandable");this.$element.removeClass("arch-expandable")}else{this.$element.addClass("arch-expandable");this.$element.removeClass("expandable");this.$element.removeClass("lazy-expandable")}}else{if(this.has_children){this.$element.addClass("lazy-expandable");this.$element.removeClass("expandable");this.$element.removeClass("arch-expandable")}else{this.$element.removeClass("lazy-expandable");this.$element.removeClass("expandable");this.$element.removeClass("arch-expandable")}}}}if(this.has_scope(this.workspace.scope)){this.$element.removeClass("hidden")}if(this.state==="open"&&this.is_expandable()){this.$element.addClass("open")}else{this.$element.removeClass("open")}if(this.workspace.show_all){this.$element.removeClass("archived");this.$element.slideDown(this.workspace.ANIM_SPEED)}else{if(this.archived){this.$element.addClass("archived");this.$element.slideUp(this.workspace.ANIM_SPEED)}else{this.$element.removeClass("archived");this.$element.slideDown(this.workspace.ANIM_SPEED)}}if(this.$todo_state){a=this.get_todo_state();if(a.pk>0){this.$todo_state.html(a.display)}else{this.$todo_state.html("")}f=this;this.$todo_state.todoState({states:this.workspace.todo_states,node_id:this.pk,heading:this,click:function(g){f.todo_id=g.todo_id}})}if(this.$title){if(this.archived){e='<span class="archived-text">';e+=this.title;e+="</span>\n"}else{e=this.title}this.$title.html(e)}if(this.$text&&this.text){this.$text.html(this.text);this.$text.alohaText({heading:this,$parent:this.$element})}if(this.$buttons){d=this.$buttons.children(".archive-btn");if(this.archived){d.addClass("icon-folder-open");d.removeClass("icon-folder-closed")}else{d.addClass("icon-folder-closed");d.removeClass("icon-folder-open")}}if(this.populated){this.$element.addClass("populated")}c=this.workspace.headings.filter({parent_id:this.pk});for(b=0;b<c.length;b+=1){c[b].redraw()}};GtdHeading.prototype.set_indent=function(b,c){var a=(this.icon_width+4)*c;b.css("margin-left",a+"px")};GtdHeading.prototype.show_error=function(b){var a="";a+='<i class="icon-warning-sign"></i>\n';a+="Error! Please refresh your browser\n";b.html(a)};GtdHeading.prototype.populate_children=function(b){var a,c,d;if(typeof b==="undefined"){b={}}a="/gtd/node/"+this.pk+"/descendants/";c=this;d=function(e){var f={offset:e.offset};$.getJSON(a,f,function(h){var g,j,l,m,k;if(h.status==="success"){g=h.nodes;for(j=0;j<g.length;j+=1){l=g[j];l.workspace=c.workspace;m=new GtdHeading(l);k=m.get_parent();if(k||m.level===1){c.workspace.headings.add(m)}if(k){m.create_div();if((!k.populated)&&k.$details){if(e.offset===1){k.$loading.slideUp(k.workspace.ANIM_SPEED)}else{k.$loading.hide()}}k.populated=true}}c.redraw();if((e.offset===1)&&k){k.$children.slideDown(k.workspace.ANIM_SPEED)}}})};if(!this.populated){if(this.level>0){this.$children.hide()}d({offset:1})}if(!this.populated_level_2){d({offset:2});this.populated_level_2=true}};GtdHeading.prototype.open=function(){this.state="open";this.$details.slideDown(this.workspace.ANIM_SPEED);this.populate_children();this.redraw()};GtdHeading.prototype.close=function(){this.state="closed";this.$details.slideUp(this.workspace.ANIM_SPEED);this.redraw()};GtdHeading.prototype.toggle=function(a){if(this.state==="open"){this.close()}else{if(this.state==="closed"){this.open()}}};(function(b){var a={init:function(c){var d=function(){var e=[];e.get=function(f){return this.filter(f)[0]};e.filter=function(l){var f,h,j,k,g;f=new d();for(h=0;h<this.length;h+=1){j=this[h];if(j.level===0){k=false}else{k=true}for(g in l){if(l.hasOwnProperty(g)){if(j[g] instanceof Array){if(l[g] instanceof Array){if(!((b(j.scope).not([]).length===0&&b([]).not(j.scope).length===0)&&typeof j.scope!=="undefined")){k=false}}else{if(jQuery.inArray(l[g],j[g])<0){k=false}}}else{if(j[g]!==l[g]){k=false}}}}if(k){f.push(j)}}return f};e.order_by=function(i){var f,g,h;f=/^(-)?(\S*)$/.exec(i);g=this.slice(0);h=function(k,j){var n,m,l;n=Number(k[f[2]]);m=Number(j[f[2]]);if(n&&m){l=n-m}else{if(k<j){l=-1}else{if(k>j){l=1}else{l=0}}}return l};g.sort(h);if(f[1]==="-"){g.reverse()}return g};e.add=function(h){var f,g;g=this.get({pk:h.pk});if(g){h.populated=g.populated;for(f in h){if(h.hasOwnProperty(f)){g[f]=h[f]}}}else{this.push(h)}};return e};if(!c){c={}}if(c.get_proto){return GtdHeading}this.each(function(){var o,g,m,l,p,e,f,n,k,q,j;o=b(this);g=o.attr("data-node_id");if(g==="0"){m="Projects:"}else{m="Children:"}l={};p=["blue","brown","purple","red","green","teal","slateblue","darkred"];e=300;f=new GtdHeading({pk:g,title:"Outline Workspace",});f.$element=o;f.$element.addClass("heading");f.workspace=f;f.show_all=false;f.$element.data("nodeOutline",f);f.level=0;f.COLORS=p;f.ANIM_SPEED=e;f.state="open";f.color=f.COLORS[0];f.headings=new d();if(typeof c.todo_states!=="undefined"){f.todo_states=c.todo_states}else{f.todo_states={todo_id:0,display:"[None]"}}if(c.scopes){f.scopes=c.scopes}else{f.scopes={}}f.scopes.activate=function(h){f.scope=h;f.$scope_tabs.find("li.active").each(function(){b(this).removeClass("active")});f.$scope_tabs.find('li[pk="'+h+'"]').addClass("active");f.$children.fadeOut(f.ANIM_SPEED,function(){f.redraw()});f.$children.fadeIn(f.ANIM_SPEED)};f.scopes.get=function(i){var h;for(h in f.scopes){if(f.scopes.hasOwnProperty(h)){if(f.scopes[h].pk===i){return f.scopes[h]}}}};f.get_heading=function(r){var h;for(h=0;h<this.headings.length;h+=1){if(this.headings[h].pk===r){return this.headings[h]}}};f.headings.add(f);o.find(".ow-heading").each(function(){var u,t,h,w,x,v,z,i,s,r,y;u=b(this);t=u.attr("data-node_id");h=u.attr("data-todo_id");w=u.attr("data-title");x=u.attr("data-text");v=f.pk;z=u.attr("data-tag_string");i=u.attr("data-previous_sibling");if(u.attr("data-is_leaf_node")==="False"){s=true}else{s=false}if(i===""){i=undefined}else{i=Number(i)}r={pk:t,title:w,text:x,todo_state:h,parent_id:v,tags:z,level:1,previous_sibling_id:i,has_children:s,workspace:f};y=new GtdHeading(r);f.headings.add(y)});o.html("");n="";n+='<ul class="nav nav-tabs" id="scope-tabs">\n';n+='\t<li pk="0" class="pointer"><a>All</a></li>\n';for(k in f.scopes){if(f.scopes.hasOwnProperty(k)){q=f.scopes[k];if(q.model==="gtd.scope"){n+='\t<li pk="'+q.pk+'" class="pointer"><a>'+q.fields.display+"</a></li>\n"}}}n+='\t<li pk="-1" class="pointer"><a>None</a></li>\n';n+="</ul>";o.append(n);f.$scope_tabs=o.children("#scope-tabs");f.$scope_tabs.find("li").on("click.switch",function(i){var h=Number(b(this).attr("pk"));f.scopes.activate(h)});o.append("<strong>"+m+'</strong><br />\n<div class="children"></div>');f.$children=o.children(".children");j=f.headings.filter({level:1});f.redraw();f.scopes.activate(0);n="";n+='<div class="ow-buttons" id="add-heading">\n';n+='  <i class="icon-plus-sign"></i>Add Heading\n';n+="</div>\n";n+='<label class="checkbox" id="show-all-label">\n';n+='  <input class="ow-buttons show-all" type="checkbox">';n+="  </input>Show archived</label>\n";f.$children.append(n);f.$showall=o.find(".show-all");f.$showall.bind("change.show-all",function(h){if(f.show_all){f.show_all=false}else{f.show_all=true}f.redraw()});f.$add=o.find("#add-heading");b.get("/gtd/node/new/",{format:"modal_form"},function(h){f.$element.append(h);f.$edit_modal=f.$element.children("#new-modal");attach_pickers(f.$edit_modal);f.$add.on("click",function(r){var i=b(this);i.nodeEdit({show:true,$modal:f.$edit_modal,parent_id:f.pk,changed:function(s){var t;s.workspace=f;t=new GtdHeading(s);f.headings.add(t);f.redraw()}})})});f.populated_level_2=true;f.populate_children()})},};b.fn.nodeOutline=function(d){var c;if(a[d]){c=a[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){c=a.init.apply(this,arguments)}else{b.error("Method "+d+" does not exist on jQuery.todoState")}}return c}}(jQuery));(function(a){a.fn.agenda=function(i){var j,f,h,c,g,b,e,d;j=this.find("form.date");f=j.find('input[name="date"][type="text"]');h=this;if(!this.data("agenda")){this.data("agenda",{})}c=a.extend(this.data("agenda"),i);g=function(n){var o,k,m,q,l,p;o=/(\d{4})-([01]?\d)-([0-3]?\d)/;k=o.exec(n);if(k){m=Number(k[1]);q=Number(k[2])-1;l=Number(k[3]);p=new Date(m,q,l)}else{p=undefined}return p};c.date=g(this.attr("date"));if(!c.date){b=new Date();e=new Date(b.getFullYear(),b.getMonth(),b.getDate());c.date=e}this.data("agenda",c);d=function(){var k="/gtd/agenda/"+c.date.getFullYear()+"-"+(c.date.getMonth()+1)+"-"+c.date.getDate()+"/";a.getJSON(k,{format:"json"},function(m){var n,l;if(m.status==="success"){h.find(".daily").html(m.daily_html);h.find(".timely").html(m.timely_html);h.find(".deadlines").html(m.deadlines_html);n="";l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n+=l[c.date.getMonth()]+". ";n+=c.date.getDate()+", ";n+=c.date.getFullYear();h.children(".date:header").html(n)}})};j.bind("submit",function(){var k=g(f.val());if(k){c.date=k;h.data("agenda",c);d()}else{jQuery.error("Improperly formatted date: "+f.val())}return false});h.find(".todo-state").each(function(){var k=a(this).parent().attr("node_id");a(this).todoState({states:c.states,node_id:k,click:function(){d()}})});return this}}(jQuery));(function(b){var a={init:function(k){var i,g,n,d,c,e,l,f,j,h,m;if(typeof k==="undefined"){k={}}i="";if(k.url){i=k.url}else{if(k.heading){i="/gtd/node/"+k.heading.pk+"/edit/"}else{if(k.node_id>0){i="/gtd/node/"+k.node_id+"/edit/"}else{if(k.parent_id>0){i="/gtd/node/"+k.parent_id+"/new/"}else{if(k.parent){i="/gtd/node/"+k.parent.pk+"/new/"}else{i="/gtd/node/new/"}}}}}g=this.data("nodeEdit");if(k.parent){if(g){g.parent=k.parent}k.parent_id=k.parent.pk}if(g){g.edit_url=i;g.$modal.find("#edit_url").attr("value",i)}else{g={edit_url:i};n=k.show;d=b(k.target);c=this;e=k.node_id;l=k.parent_id;f=k.changed;j=k.on_modal;g.changed=f;g.heading=k.heading;g.parent=k.parent;g.on_modal=k.on_modal;g.$target=d;h=function(){var z,A,y,p,t,q,v,w,r,x,u,o;if(g.heading){z=g.heading;g.$modal.find(".header-title").html('Edit "'+z.title_html+'"');g.$modal.find("#id_title").val(z.title);g.$modal.find("#id_text").val(z.text);g.$modal.find("#id_text-aloha").html(z.text);g.$modal.find("#id_tag_string").val(z.tag_string);g.$modal.find("#id_archived").prop("checked",z.archived);g.$modal.find("#id_scheduled_date").val(z.scheduled_date);g.$modal.find("#id_scheduled_time").val(z.scheduled_time);if(z.scheduled_time_specific){g.$modal.find("#id_scheduled_time_specific").attr("checked","checked")}g.$modal.find("#id_deadline_date").val(z.deadline_date);g.$modal.find("#id_deadline_time").val(z.deadline_time);if(z.deadline_time_specific){g.$modal.find("#id_deadline_time_specific").attr("checked","checked")}g.$modal.find("#id_repeating_number").val(z.repeating_number);g.$modal.find("#id_repeats").prop("checked",z.repeats);A='option[value="'+z.repeating_unit+'"]';g.$modal.find("#id_repeating_unit option").prop("selected",false);g.$modal.find("#id_repeating_unit").find(A).prop("selected",true);g.$modal.find("#id_repeats_from_completion").prop("checked",z.repeats_from_completion);repeating_toggle("#id_repeats",g.$modal);A='option[value="'+z.priority+'"]';g.$modal.find("#id_priority option").prop("selected",false);g.$modal.find("#id_priority").find(A).prop("selected",true);if(z.todo_id){A='option[value="'+z.todo_id+'"]'}else{A='option[value="0"]'}g.$modal.find("#id_todo_state").children(A).prop("selected",true);y=g.$modal.find("#id_scope");y.find("option").prop("selected",false);for(p=0;p<z.scope.length;p+=1){A='option[value="'+z.scope[p]+'"]';y.find(A).prop("selected",true)}t=g.$modal.find("#id_related_projects");t.find("option").prop("selected",false);for(p=0;p<z.related_projects.length;p+=1){A='option[value="'+z.related_projects[p]+'"]';t.find(A).prop("selected",true)}}else{q=["#id_title","#id_scheduled_date","#id_scheduled_time","#id_deadline_date","#id_deadline_time","#id_tag_string","#id_text","#id_repeating_number"];v=["#id_todo_state","#id_priority","#id_related_projects","#id_scope","#id_repeating_unit"];w=["#id_archived","#id_scheduled_time_specific","#id_deadline_time_specific","#id_repeats","#id_repeats_from_completion"];g.$modal.find(".header-title").html("New node");for(p=0;p<q.length;p+=1){g.$modal.find(q[p]).val("")}r=function(){b(this).prop("selected",false)};for(p=0;p<v.length;p+=1){g.$modal.find(v[p]).find("option:selected").each(r);g.$modal.find(v[p]).find('option[value=""]').prop("selected",true)}if(g.parent){x=g.parent.scope;y=g.$modal.find("#id_scope");for(p=0;p<x.length;p+=1){y.find('option[value="'+x[p]+'"]').prop("selected",true)}u=g.parent.related_projects;o=g.$modal.find("#id_related_projects");for(p=0;p<u.length;p+=1){A='option[value="'+u[p]+'"]';o.find(A).prop("selected",true)}}for(p=0;p<w.length;p+=1){g.$modal.find(w[p]).prop("checked",false)}g.$modal.find("#id_text-aloha").html('<br class="aloha-cleanme" style="">')}g.$modal.modal("toggle");g.$modal.find("#id_title").focus()};m=function(){var q,p,o,r;q=g.$modal.find("#id_text");p=Aloha.jQuery(q);p.aloha();g.$modal.modal({show:false});if(n){h()}c.click(function(s){s.preventDefault();h()});g.$modal.on("hidden",function(){a.reset({$elem:c})});g.$modal.on("show",function(){g.$modal.find(".modal-body").scrollTop(0)});g.$modal.on("shown",function(){g.$modal.find("#id_title").focus()});o=g.$modal.find("form");o.unbind("submit.submit_edit");o.on("submit.submit_edit",function(u){var t,v,s;if(!validate_node(b(this))){return false}u.preventDefault();t=o.serialize();t+="&format=json&auto_repeat=false";v=g.$modal.find("#edit_url").val();if(v){s=v}else{s=g.edit_url}b(this).data("nodeEdit",g);r=this;b.post(s,t,function(x){var w,y;x=b.parseJSON(x);if(x.status==="success"){w=x.node_data;y=b(r).data("nodeEdit");if(w.todo_state===null){w.todo_state=0}y.todo_id=w.todo_state;if(y.heading){y.heading.set_fields(w)}if(d){d.find(".update").each(function(){var A,z;A=b(this).attr("data-field");z=w[A];b(this).html(z)})}y.$modal.modal("hide");if(typeof y.changed!=="undefined"){y.changed(w)}}else{console.log(x)}})});if(g.on_modal){g.on_modal(g.$modal)}};if(k.$modal){g.$modal=k.$modal;g.$modal.find("#edit_url").val(g.edit_url);m()}else{b.get(g.edit_url,{format:"modal_form"},function(o){c.after(o);g.$modal=c.next(".modal");attach_pickers(g.$modal);var p=g.$modal.find("#id_todo_state").children('option[selected="selected"]');if(p.length===1){g.todo_id=Number(p.attr("value"))}else{g.todo_id=0}m()})}c.data("nodeEdit",g)}},update:function(e){var i,h,d,c,g,f;i=this;h=i.data("nodeEdit");if(h){d=h.$modal;if(typeof e.todo_id!=="undefined"){h.todo_id=e.todo_id;c=d.find("#id_todo_state");c.find("option").prop("selected",false);f='option[value="'+e.todo_id+'"]';g=c.find(f);g.prop("selected",true)}i.data("nodeEdit",h)}},reset:function(d){var c;if(typeof d==="undefined"){d={}}if(typeof d.$elem!=="undefined"){c=d.$elem}else{c=this}return c.each(function(){var i,h,e,g,f;i=b(this);h=i.data("nodeEdit");if(h){e=h.$modal;g=e.find("#id_todo_state");g.find("option").prop("selected",false);f='option[value="'+h.todo_id+'"]';g.find(f).prop("selected",true)}})}};b.fn.nodeEdit=function(d){var c;if(a[d]){c=a[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){c=a.init.apply(this,arguments)}else{b.error("Method "+d+" does not exist on jQuery.nodeEdit")}}return c}}(jQuery));(function(b){var a={init:function(c){return this.each(function(){var f,e,d;if(typeof c==="undefined"){c={}}f=b(this);e={};e.node_id=f.attr("node_id");e.url="/gtd/node/"+e.node_id+"/edit/";e.sel="button";d=f.find(e.sel);d.bind("click.buttons",function(j){var g,i,h;j.preventDefault();g=b(this);i=g.attr("value");h={format:"json",todo_id:i};jQuery.post(e.url,h,function(k){k=b.parseJSON(k);if(k.status==="success"){a.update({todo_id:k.todo_id,$elem:f});if(typeof c.callback!=="undefined"){c.callback(k)}}})});f.data("todobuttons",e)})},update:function(d){var c;if(typeof d.$elem==="undefined"){c=this}else{c=d.$elem}return c.each(function(){var f,e,g;f=b(this);e=f.data("todobuttons");if(!e){a.init()}if(typeof d.todo_id!=="undefined"){e.todo_id=d.todo_id}b(e.sel).removeClass("active");g=e.sel+'[value="'+e.todo_id+'"]';f.find(g).addClass("active");f.data("todobuttons",e)})}};b.fn.todoButtons=function(d){var c;if(a[d]){c=a[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){c=a.init.apply(this,arguments)}else{b.error("Method "+d+" does not exist on jQuery.todoButtons")}}return c}}(jQuery));