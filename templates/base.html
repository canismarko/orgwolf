{% load gtd_extras %}
{% comment %}
  Copyright 2012 Mark Wolf

  This file is part of OrgWolf.

  OrgWolf is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
{% endcomment %}
<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" ng-app="orgWolf">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>
      {% block title%}TODO: implement title{% endblock %}
    </title>
    {% if debug %}
      <link rel="icon"
	    type="image/png"
	    href="{{ STATIC_URL }}orgwolf-icon-debug.png" />
    {% else %}
      <link rel="icon"
	    type="image/png"
	    href="{{ STATIC_URL }}orgwolf-icon.ico" />
    {% endif %}
      <link rel="apple-touch-icon"
	    href="{{ STATIC_URL }}orgwolf-icon-114.png" />
    {% if enable_css %}
      {% block all_style %}

	{% if local_net %}
	  <link rel="stylesheet" type="text/css"
		href="{{ STATIC_URL }}bootstrap/css/bootstrap.min.css" />
	  <link rel="stylesheet" type="text/css"
		href="{{ STATIC_URL }}bootstrap-switch.css" />
	  <link rel="stylesheet" type="text/css"
		href="{{ STATIC_URL }}aloha/css/aloha.css" />
	{% else %}
	  <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.0/css/bootstrap.min.css" />
	  <link rel="stylesheet" type="text/css" href="http://cdn.aloha-editor.org/latest/css/aloha.css" />
	  <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-switch/1.8/css/bootstrap-switch.css" />


	{% endif %}

    {% if debug %}
    <link rel="stylesheet" type="text/css"
	  href="{{ STATIC_URL }}datepicker/datepicker.css" />
    <link rel="stylesheet" type="text/css"
    	  href="{{ STATIC_URL }}timepicker/timepicker.css" />
    <link rel="stylesheet" type="text/css"
	  href="{{ STATIC_URL }}social/auth-buttons.css" />
    <link rel="stylesheet/less" type="text/css"
	  href="{{ STATIC_URL }}orgwolf.less" />
    <script src="{{ STATIC_URL }}less-1.3.3.min.js"
	    type="text/javascript"></script>
    {% else %}
    <link rel="stylesheet" type="text/css"
	  href="{{ STATIC_URL }}orgwolf.css" />
    {% endif %}

    {% block style %}
    <style type="text/css">
    </style>
    {% endblock %}
    {% endblock %}
    {% endif %}
    {% if enable_js %}
    {% block all_script %}

    {% if local_net %}
    <script src="{{ STATIC_URL }}jquery-1.8.3.min.js"></script>
    <script src="{{ STATIC_URL }}bootstrap/js/bootstrap.min.js"></script>
    <script src="{{ STATIC_URL }}bootstrap-switch.min.js"></script>
    <script src="{{ STATIC_URL }}angular/angular.js"></script>
    <script src="{{ STATIC_URL }}angular/angular-animate.js"></script>
    <script src="{{ STATIC_URL }}angular/angular-resource.js"></script>
    <script src="{{ STATIC_URL }}angular/angular-sanitize.js"></script>
    {% else %}
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-switch/1.8/js/bootstrap-switch.min.js"></script>
    <script src="http://code.angularjs.org/1.2.0-rc.3/angular.min.js"></script>
    <script src="http://code.angularjs.org/1.2.0-rc.3/angular-animate.min.js"></script>
    <script src="http://code.angularjs.org/1.2.0-rc.3/angular-sanitize.min.js"></script>
    <script src="http://code.angularjs.org/1.2.0-rc.3/angular-resource.js"></script>
    {% endif %}

    <script src="https://login.persona.org/include.js"></script>

    {% if debug %}
      <script src="{{ STATIC_URL }}jquery.mockjax.js"></script>
      <script src="{{ STATIC_URL }}jquery.cookie.js"></script>
      <script src="{{ STATIC_URL }}datepicker/bootstrap-datepicker.js"></script>
      <script src="{{ STATIC_URL }}timepicker/bootstrap-timepicker.js"></script>
      <script src="{{ STATIC_URL }}orgwolf.js"></script>
      <script type="text/javascript" src="{{ STATIC_URL }}gtd-models.js"></script>
      <script type="text/javascript" src="{{ STATIC_URL }}gtd-ctrl.js"></script>
      <script type="text/javascript" src="{{ STATIC_URL }}wolfmail-models.js"></script>
      <script type="text/javascript" src="{{ STATIC_URL }}wolfmail-ctrl.js"></script>
      <script src="{{ STATIC_URL }}persona.js"></script>
    {% else %}
      <script src="{{ STATIC_URL }}orgwolf-min.js"></script>
    {% endif %}
    {% include 'aloha.html' %}
    <script type="text/javascript">
    // Page specific persona setup
    persona_user = {% if request.user.is_authenticated %}"{{ request.user.username }}"{% else %}null{% endif %};
    </script>
    {% block script %}
    <script type="text/javascript">
    $(document).ready(function() {
	{% if request.user.is_authenticated %}
	// Convert utility links to dropdown menu
	$('.util-dropdown').wrapAll('<ul class="dropdown-menu" role="menu"' +
				    ' aria_labeledby="lblAccounts" />');
	$('.util-dropdown').parent().wrap('<li class="dropdown" />');
	$('.util-dropdown').parent().before(
	    '<a class="dropdown-toggle"' +
		' id="lblAccounts"' +
		' role="button"' +
		' data-toggle="dropdown"' +
		' href="#">' +
		'{{ request.user.get_display }}' +
		'</div>'
	);
	$('.util-dropdown').parent().prev('a.dropdown-toggle').append(
	    '<b class="caret" />');
	{% endif %}
	// Tweak document for context filtering
	$('#nav-actions').append('<b id="btn-actions" class="caret"></b>');
	// $('#lblContext').hide();
	$('#nav-actions').bind('click', function(e) {
	    console.log(e.target.className);
	    if ( e.target.className !== 'caret' ) {
		// Redirect if the caret was not clicked
		window.location = e.currentTarget.href;
		return false;
	    } else {
		// Otherwise just show the dropdown
		return true;
	    }
	});
    });
    </script>
    {% endblock %}
    {% endblock %}
    {% endif %}
  </head>
  <body ow-logged-in="{{ request.user.is_authenticated }}">
    {% block nav %}
    <nav class="navbar navbar-default" role="navigation">
      <div class="navbar-header">
	<button type="button" class="navbar-toggle"
		data-toggle="collapse" data-target=".navbar-ex1-collapse">
	  <span class="sr-only">Toggle Navigation</span>
	  <span class="icon-bar"></span>
	  <span class="icon-bar"></span>
	  <span class="icon-bar"></span>
	</button>
	<a class="navbar-brand" id="logo" href="/">
	  {% if debug %}
	  <img src="{{ STATIC_URL }}orgwolf-logo-debug.png" />
	  {% else %}
	  <img src="{{ STATIC_URL }}orgwolf-logo.png" />
	  {% endif %}
	</a>
      </div>

      <div class="collapse navbar-collapse navbar-ex1-collapse">
	<ul class="nav navbar-nav">
	  <!-- Next actions -->
	  <li{% if 'actions' in request.get_full_path %} class="active"{% endif %}>
	    {% if request.session.context_id %}
	    <a href="{% url 'list_display' context_id=request.session.context_id context_slug=request.session.context_name|slugify %}">
	      <span class="glyphicon glyphicon-list"></span>
	      {{ request.session.context_name }} Actions
	    </a>
	    {% else %}
	    <a href="{% url 'list_display' %}">
	      <span class="glyphicon glyphicon-list"></span>
	      Next Actions
	    </a>
	    {% endif %}
	  </li>
	  <!-- Inbox -->
	  <li{% if 'inbox' in request.get_full_path %} class="active"{% endif %}>
	    <a href="{% url 'inbox' %}">
	      <span class="glyphicon glyphicon-inbox"></span>
	      Inbox
	    </a>
	  </li>
	  <!-- Project Outline -->
	  <li{% if 'project' in request.get_full_path %} class="active"{% endif %}>
	    <a href="{% url 'projects' %}">
	      <span class="glyphicon glyphicon-tasks"></span>
	      Projects</a>
	  </li>
	</ul>

	{% block inbox_widget %}
	  <form class="navbar-form navbar-left col-md-3"
		ng-controller="inboxCapture" ng-submit="capture($event)">
	    <div class="input-group">
	      <input type="text" name="new_inbox_item" id="new_inbox_item"
		     class="form-control"
		     placeholder="To inbox..."
		     {% if request.user.is_anonymous %} disabled{% endif %}>
		   </input>
	  <span class="input-group-btn">
	    <button type="submit" class="btn btn-default"
		    {% if request.user.is_anonymous %} disabled{% endif %}>
	      Save
	    </button>
	  </span>
	    </div>
	  </form>
	{% endblock %}

	<ul class="nav navbar-nav navbar-right">
	  <!-- Button for feedback form -->
	  {% if request.user.is_authenticated %}
	  <li class="pull-right">
	    <a href="#" data-toggle="modal" data-target="#feedbackModal">
	      Feedback
	    </a>
	  </li>

	  {% if request.user.is_staff %}
	  <li class="util-dropdown" role="menuitem">
	    <a href="/admin/">Admin</a>
	  </li>
	  {% endif %}
	  <li class="util-dropdown" role="menuitem">
	    <a href="/accounts/profile/">Account</a>
	  </li>
	  <li class="util-dropdown" role="menuitem">
	    <a href="#" id="logout">Logout</a>
	  </li>
	  {% else %}
	  {{ settings }}
	  <li>
	    <a href="#" class="persona-button navbar-brand">
	      <img src="{{ STATIC_URL }}/persona-button.png" />
	    </a>
	  </li>
	  {% endif %}
	</ul>
      </div>
    </nav><!-- </nav class="navbar"> -->

    {% endblock %}{# end of nav #}

    <!-- Form for submitting feedback -->
    <div class="modal fade" id="feedbackModal"
	 ng-controller="owFeedback">
      <div class="modal-dialog">
	<div class="modal-content">
	  <form name="form" novalidate>
	    <div class="modal-header">
	      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	      <h4 class="modal-title">Feedback</h4>
	    </div>
	    <div class="modal-body">
	      <textarea class="form-control" rows="5"
			placeholder="What's on your mind?"
			ng-model="feedback.text"
			required
			ng-hide="success"></textarea>
	      <div class="alert alert-success"
		   ng-show="success">Thank you for your feedback.</div>
	    </div>
	    <div class="modal-footer">
	      <button type="button" class="btn btn-primary"
		      name="feedback_text"
		      ng-click="send_feedback(feedback)"
		      ng-disabled="form.$invalid">
		Submit Feedback
	      </button>
	      <button type="button" class="btn btn-link" data-dismiss="modal">Cancel</button>
	    </div>
	  </form>
	</div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <!-- Alert if the user is not logged in -->
    {% if request.user.is_anonymous %}
    <div class="container" id="unauth-warn">
      <div class="row">
	<div class="alert alert-warning col-md-5 col-md-offset-3">
	  You are in <strong>demo mode</strong>; changes will not be
	  saved.<br />Please
	  <a href="#" class="persona-button">
	    <img src="{{ STATIC_URL}}/persona-button-small.png" /></a>
	  to create a new account.
	</div>
      </div>
    </div>
    {% endif %}

	{% block content %}
	<br />This feature is not yet impletemented. Check back later.<br />
	{% endblock %}

    </div>

  </body>
</html>
