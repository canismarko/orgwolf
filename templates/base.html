{% load gtd_extras %}
{% comment %}
Copyright 2012 Mark Wolf

This file is part of OrgWolf.

OrgWolf is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
{% endcomment %}
<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>{% block title%}TODO: implement title{% endblock %}</title>
    {% if debug %}
    <link rel="icon"
	  type="image/png"
	  href="{{ STATIC_URL }}orgwolf-icon-debug.png" />
    {% else %}
    <link rel="icon"
	  type="image/png"
	  href="{{ STATIC_URL }}orgwolf-icon.ico" />
    {% endif %}
    {% if enable_css %}
    {% block all_style %}

    {% if local_net %}
    <link rel="stylesheet" type="text/css" 
	  href="{{ STATIC_URL }}bootstrap/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" 
	  href="{{ STATIC_URL }}aloha/css/aloha.css" />
    {% else %}
    <link rel="stylesheet" type="text/css" 
	  href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" />
    <link rel="stylesheet" type="text/css" 
	  href="http://cdn.aloha-editor.org/latest/css/aloha.css" />
    {% endif %}

    {% if debug %}
    <link rel="stylesheet" type="text/css"
	  href="{{ STATIC_URL }}datepicker/datepicker.css" />
    <link rel="stylesheet" type="text/css"
	  href="{{ STATIC_URL }}timepicker/timepicker.css" />
    <link rel="stylesheet" type="text/css"
	  href="{{ STATIC_URL }}persona-buttons.css" />
    <link rel="stylesheet" type="text/css"
	  href="{{ STATIC_URL }}social/auth-buttons.css" />
    <link rel="stylesheet/less" type="text/css"
	  href="{{ STATIC_URL }}orgwolf.less" />
    <script src="{{ STATIC_URL }}less-1.3.3.min.js"
	    type="text/javascript"></script>
    {% else %}
    <link rel="stylesheet" type="text/css"
	  href="{{ STATIC_URL }}orgwolf.css" />
    {% endif %}

    {% block style %}
    <style type="text/css">
    </style>
    {% endblock %}
    {% endblock %}
    {% endif %}
    {% if enable_js %}
    {% block all_script %}

    {% if local_net %}
    <script src="{{ STATIC_URL }}jquery-1.8.3.min.js"></script>
    <script src="{{ STATIC_URL }}bootstrap/js/bootstrap.js"></script>
    {% else %}
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
    {% endif %}

    <script src="https://login.persona.org/include.js"></script>

    {% if debug %}
    <script src="{{ STATIC_URL }}jquery.mockjax.js"></script>
    <script src="{{ STATIC_URL }}jquery.cookie.js"></script>
    <script src="{{ STATIC_URL }}datepicker/bootstrap-datepicker.js"></script>
    <script src="{{ STATIC_URL }}timepicker/bootstrap-timepicker.js"></script>
    <script src="{{ STATIC_URL }}orgwolf.js"></script>
    <script src="{{ STATIC_URL }}persona.js"></script>
    {% else %}
    <script src="{{ STATIC_URL }}orgwolf-min.js"></script>
    {% endif %}
    {% include 'aloha.html' %}
    <script type="text/javascript">
    // Page specific persona setup
    persona_user = {% if request.user.is_authenticated %}"{{ request.user.username }}"{% else %}null{% endif %};
    </script>
    {% block script %}
    <script type="text/javascript">
    $(document).ready(function() {
	{% if request.user.is_authenticated %}
	// Convert utility links to dropdown menu
	$('.util-dropdown').wrapAll('<ul class="dropdown-menu" role="menu"' + 
				    ' aria_labeledby="lblAccounts" />');
	$('.util-dropdown').parent().wrap('<li class="dropdown" />');
	$('.util-dropdown').parent().before(
	    '<a class="dropdown-toggle"' +
		' id="lblAccounts"' + 
		' role="button"' +
		' data-toggle="dropdown"' + 
		' href="#">' +
		'{{ request.user.get_display }}' +
		'</div>'
	);
	$('.util-dropdown').parent().prev('a.dropdown-toggle').append(
	    '<b class="caret" />');
	{% endif %}
	// Tweak document for context filtering
	$('#nav-actions').append('<b id="btn-actions" class="caret"></b>');
	$('#lblContext').hide();
	$('#nav-actions').bind('click', function(e) {
	    console.log(e.target.className);
	    if ( e.target.className !== 'caret' ) {
		// Redirect if the caret was not clicked
		window.location = e.currentTarget.href;
		return false;
	    } else {
		// Otherwise just show the dropdown
		return true;
	    }
	});
    });
    </script>
    {% endblock %}
    {% endblock %}
    {% endif %}
  </head>
  <body>
    {% block nav %}
    <div class="navbar">
      <div class="navbar-inner">
	<a class="brand" id="logo" href="/">
	  {% if debug %}
	  <img src="{{ STATIC_URL }}orgwolf-logo-debug.png" />
	  {% else %}
	  <img src="{{ STATIC_URL }}orgwolf-logo.jpg" />
	  {% endif %}
	</a>
	<ul class="nav">
	  <li{% if 'agenda' in request.get_full_path %} class="active"{% endif %}>
	    <a href="{% url 'gtd.views.agenda_display' %}">
	      Today's Agenda
	    </a>
	  </li>
	  <!-- Next actions -->
	  <li class="dropdown{% if 'list' in request.get_full_path %} active{% endif %}">
	    <a id="nav-actions" class="dropdown-toggle" data-toggle="dropdown"
	       {% if request.session.context %}href="{% url 'gtd.views.list_display' '/next' %}context{{ request.session.context.pk }}/" >
	      Actions ({{ request.session.context.name }})
	    {% else %}href="{% url 'gtd.views.list_display' '/next' %}">Next Actions
	      {% endif %}
	    </a>
	    <ul class="dropdown-menu">
	      <!-- Currently active context -->
	      <li>
	      {% if request.session.context %}
		<a href="{% url 'gtd.views.list_display' '/next' %}context{{ request.session.context.pk }}/">{{ request.session.context.name }}</a>
	      {% else %}
		<a href="{% url 'gtd.views.list_display' '/next' %}">All</a>
		{% endif %}
	      </li>
	      <li class="divider"></li>
	      <!-- Other contexts -->
	      {% if request.session.context %}
	      <li>
		<a href="{% url 'gtd.views.list_display' '/next' %}context0/">All</a>
	      </li>
	      {% endif %}
	      {% for context in contexts %}
	      {% if not context.pk == request.session.context.pk %}
	      <li>
		<a href="{% url 'gtd.views.list_display' '/next' %}context{{ context.pk }}/">
		  {{ context.name }}
		</a>
	      </li>
	      {% endif %}
	      {% endfor %}
	    </ul>
	  </li>
	  <li><a href="{% url 'wolfmail.views.display_label' %}">Inbox</a></li>
	  <li{% if 'node' in request.get_full_path %} class="active"{% endif %}>
	    <a href="{% url 'gtd.views.display_node' %}">Projects</a>
	  </li>
	</ul>
	
	{% block inbox_widget %}
	<form class="navbar-form pull-left" method="POST" action="/gtd/toinbox/?next={{request.get_full_path}}" id="new_inbox_form">
	  <div class="input-append">
	    <input type="text" name="new_inbox_item" id="new_inbox_item" class="input-small" placeholder="To inbox..." />
	    <input type="submit" value="Save" class="btn" />
	  </div>
	  {% csrf_token %}
	</form>
	{% endblock %}

	<ul class="nav pull-right">
	  <li class="pull-right"><a href="https://github.com/m3wolf/OrgWolf/issues/new">Feedback</a></li>
	  {#<li><a href="/feedback/?next={{request.get_full_path}}">Feedback</a></li>#}
	  {% if request.user.is_authenticated %}
	  {% if request.user.is_staff %}
	  <li class="util-dropdown" role="menuitem">
	    <a href="/admin/">Admin</a>
	  </li>
	  {% endif %}
	  <li class="util-dropdown" role="menuitem">
	    <a href="/accounts/profile/">Account</a>
	  </li>
	  <li class="util-dropdown" role="menuitem">
	    <a href="/accounts/logout/">Logout</a>
	  </li>
	  {% else %}
	  <li>
	    <a href="/accounts/login/?next={{request.get_full_path}}">Login</a>
	  </li>
	  {% endif %}
	</ul>
      </div>
    </div><!-- </div class="navbar"> -->
    
    {% endblock %}{# end of nav #}

    {# Search box #}
    {% block search %}
    {% include "gtd/search_box.html" %}
    {% endblock %}

    {% block content %}
    <br />This feature is not yet impletemented. Check back later.<br />
    {% endblock %}
  </body>
</html>
