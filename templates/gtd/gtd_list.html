{% extends 'base.html' %}
{% load gtd_extras %}
{% comment %}
Copyright 2012 Mark Wolf

This file is part of OrgWolf.

OrgWolf is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
{% endcomment %}
{% block title %}
{% if current_context %}{{ current_context.name }} List
{% else %}ToDo Lists
{% endif %}
{% endblock %}

{% block script %}
{{ block.super }}
<script>
    $('document').ready(function() {
	$('#gtd-list').nodeList({
	    states: {% autoescape off %}{{ all_todo_states_json }}{% endautoescape %}
	});
    });
</script>
{% endblock %}

{% block style %}
{{ block.super }}
<style type="text/css">
#gtd-list .todo-state
{
    display: inline-block
}
#gtd-list td.todo-col
{
    width: 100px;
}
</style>
{% endblock %}

{% block content %}

{# Scope tabs #}
{% include "gtd/scope_tabs.html" %}

{# Filters #}
<form action="" method="POST" class="form-inline">
  {% include "gtd/scope_filter.html" %}
  Context:
  <select name="context">
    <option value="0"
	    {% if current_context = None %}selected="selected"{% endif %}>
      None
    </option>
    {% for context in all_contexts %}
    <option value="{{context.id}}"
	    {% if current_context.id = context.id %}selected="selected"{% endif %}>
      {{context.name}}
    </option>
    {% endfor %}
  </select><br />
  {% for todo_state in all_todo_states_query %}
  <label for="todo{{ todo_state.id }}" class="checkbox inline">
  <input type="checkbox" 
	 id="todo{{ todo_state.id }}" 
	 name="todo{{ todo_state.id }}" 
	 value="Yes"  
	 {% if todo_state in todo_states_query %}checked="checked" {% endif %}/>
{{ todo_state.as_html }}</label>
  {% endfor %}
  {% if parent %}
  <input type="hidden" name="parent_id" 
	 value="{{ parent.pk }}">
  {% endif %}
  <input type="submit" value="Filter" class="btn" />
  {% csrf_token %}
</form>
{# Display nodes (if any exist #}
{% if nodes %}
<table class="table table-condensed" id="gtd-list">
  <tr>
    <th>State</th>
    <th>Description</th>
    <th>Tags</th>
  </tr>
  {% for node in nodes %}
  <tr class="list-node" node_id="{{ node.pk }}">
    <td class="todo-col">
      <div class="todo-state" todo_id="{{ node.todo_state.pk }}">
	<a href="{% url 'gtd.views.display_node' node_id=node.id %}" title="{{ node.get_hierarchy_as_string }}">{{ node.todo_state.as_html }}</a>
      </div>
    </td>
    <td>
      <a href="{% url 'gtd.views.display_node' node_id=node.id %}" title="{{ node.get_hierarchy_as_string }}">
	{{ node.title }}
      </a>
      {% if node.deadline %}Due {{ node.deadline|upcoming }}{% endif %}
      </td>
    <td><a href="{% url 'gtd.views.display_node' node_id=node.id %}" title="{{ node.get_hierarchy_as_string }}">{{ node.tag_string }}</a></td>
  </tr>
  {% endfor %}
</table>
{% else %}
{# No nodes matched so display an error message #}
<h4>No items matched your criteria. Please change filters and resubmit.</h4>
{% endif %}
{% endblock %}
