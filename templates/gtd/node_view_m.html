{% extends 'mobile.html' %}
{% load gtd_extras %}
{% block title %}
  {% if parent_node %}{{ parent_node.title }}
  {% else %}Projects{% endif %}
  | OrgWolf
{% endblock %}

{% block content %}
  <div data-role="content">
    {{ breadcrumb_list|breadcrumbs:base_url }}
    <ul data-role="listview" data-inset="true">
      {% if parent_node %}
      <li data-icon="arrow-u"><a href="{{ base_url }}">Projects List</a></li>
      {% if parent_node.parent %}
      <li data-icon="arrow-l">
	<a href="{{ base_url }}{{ parent_node.parent.pk }}">
	  Up to "{{ parent_node.parent }}"
	  </a>
      </li>
      {% endif %}
      {% endif %}
    </ul>
    <h2>{{ parent_node.title }}</h2>
    {% if parent_node %}
    <a href="{% url 'projects' pk=parent_node.pk %}edit/"
       data-role="button" data-rel="dialog">
       Edit
    </a>
    {% endif %}
    <dl>
      {% include "gtd/node_detail.html" %}
      {% if parent_node.text %}
      <dt>Text</dt>
      <dd>{{ parent_node.text|escape_html }}</dd>
      {% endif %}

      <dt>Children</dt>
      <dd>
	<ul name="children" data-role="listview" data-inset="true">
	  <!-- Button to create new heading -->
	  <li data-icon="plus">
	    {% if parent_node %}
	    <a href="{% url 'new_node' node_id=parent_node.pk %}"
	       data-rel="dialog">
	      <em>New Heading...</em>
	      {% else %}
	    <a href="{% url 'new_node' %}" data-rel="dialog">
	      <em>New Project...</em>
	      {% endif %}
	    </a>
	  </li>
	  {% for node in child_nodes_qs %}
	  <li><a href="{{ base_url }}{{ node.id }}/{{ node.slug }}/"
		 {% if child_nodes_qs|length < 6 %} data-prefetch{% endif %}>
	      {% if node.todo_state %}{{ node.todo_state.as_html }} {% endif %}
	      {{ node.title }}
	  </a></li>
	  {% endfor %}
	</ul>
      </dd>
    </dl>

    </div>
  </div>
</div>
{% endblock %}
