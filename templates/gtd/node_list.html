{% extends 'base.html' %}
{% load gtd_extras %}
{% comment %}
Copyright 2012 Mark Wolf

This file is part of OrgWolf.

OrgWolf is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
{% endcomment %}
{% block title %}
{% if current_context %}{{ current_context.name }} List
{% else %}ToDo Lists
{% endif %}
{% endblock %}

{% block content %}

<!-- Search box -->
<div class="col-sm-5 col-md-4 pull-right">
  {% include 'gtd/search_box.html' %}
</div>

{# Hierarchy, breadcrumb trail #}
  {{ breadcrumb_list|breadcrumbs:base_node_url }}

<noscript>
{# Scope tabs #}
{% include "gtd/scope_tabs.html" %}
{# Filters #}
<form action="" method="POST" class="form-inline">
  <input type="hidden" name="scope"
	 value="{% if scope %}{{ scope.pk }}{% else %}0{% endif %}"
	 />
  <label id="lblContext">
    Context:
    <select name="context" class="input-small" class="form-control">
    <option value="0"
	    {% if current_context = None %}
	    selected="selected"{% endif %}>
      None
    </option>
    {% for context in contexts %}
    <option value="{{ context.id }}"
	    {% if current_context.id = context.id %}
	    selected="selected"{% endif %}>
      {{ context.name }}
    </option>
    {% endfor %}
  </select>
  </label>
  {% for todo_state in all_todo_states_query %}
  <label for="todo{{ todo_state.id }}" class="checkbox">
  <input type="checkbox"
	 id="todo{{ todo_state.id }}"
	 name="todo{{ todo_state.id }}"
	 value="Yes"
	 {% if todo_state in todo_states_query %}
	 checked="checked"{% endif %}
	 >
	 </input>
	 {{ todo_state.as_html }}</label>
  {% endfor %}
  {% if parent %}
  <input type="hidden" name="parent_id"
	 value="{{ parent.pk }}">
  {% endif %}
  <input type="submit" value="Filter" class="btn btn-default" />
  {% csrf_token %}
</form>
{# Display nodes (if any exist #}
{% if nodes %}
<table class="table table-condensed" id="gtd-list">
  <tr>
    <th>State</th>
    <th>Description</th>
    <th>Project</th>
    <th>Tags</th>
  </tr>
  {% for node in nodes %}
  <tr class="list-node" node_id="{{ node.pk }}">
    <!-- Column for node todo state -->
    <td class="todo-col">
      <div class="todo-state"
	   todo_id="{{ node.todo_state_id }}">
	<a href="{{ base_node_url }}{{ node.pk }}"
	   title="{#{{ node.get_hierarchy_as_string }}#}">
	  {{ node.todo_state.as_html }}
	</a>
      </div>
    </td>
    <!-- Column for node description -->
    <td>
      <a href="{{ base_node_url }}{{ node.pk }}"
	 title="{#{ node.get_hierarchy_as_string }#}">
	{{ node.get_title }}
      </a>
      {% if node.deadline_date %}
      Due {{ node.deadline_str }}
      {% endif %}
    </td>
    <!-- Column for root level project -->
    <td>
      <a href="{{ node.root_url }}"
	 title="Project: {{ node.root_title }}">
	{{ node.root_title }}
      </a>
    </td>
    <!-- Column for Node.tag_string -->
    <td>
      <a href="{{ base_node_url }}{{ node.pk }}"
	 title="{#{ node.get_hierarchy_as_string }#}">
	{{ node.tag_string }}
      </a>
    </td>
  </tr>
  {% endfor %}
</table>
{% else %}
{# No nodes matched so display an error message #}
<h4>No items matched your criteria. Please change filters and resubmit.</h4>
{% endif %}
</div>
</noscript>
{% endblock %}
